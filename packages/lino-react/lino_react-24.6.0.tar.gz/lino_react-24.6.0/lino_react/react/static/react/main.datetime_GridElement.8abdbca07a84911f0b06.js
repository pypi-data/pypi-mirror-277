"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[7681],{2756:(e,t,s)=>{s.r(t),s.d(t,{ABCComponent:()=>m,Labeled:()=>c,LeafComponentBase:()=>_,LeafComponentDelayedValue:()=>g,LeafComponentInput:()=>b,LeafComponentInputChoices:()=>I,maintainTableWidth:()=>p,name:()=>d});var i=s(5247),n=s(7881),a=s.n(n),l=s(6606),r=s(1151),o=s(3748);const d="LinoComponentUtils";let h;h={classNames:s.e(4166).then(s.t.bind(s,8041,23)),queryString:Promise.all([s.e(4166),s.e(2298)]).then(s.bind(s,9320)),prDropdown:Promise.all([s.e(7134),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(3454),s.e(5350)]).then(s.bind(s,5384)),prInputText:Promise.all([s.e(9109),s.e(5573),s.e(7236),s.e(4600),s.e(2123)]).then(s.bind(s,8016))};function u(e){return t=>{t.data.hasOwnProperty("master_data")&&e.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_TABLE&&Object.keys(t.data.master_data).includes(e.props.elem.name)&&e.setState({value:t.data.master_data[e.props.elem.name]})}}function p(e,t){let s;s=void 0!==e?e:this;let i=Object.keys(s.flexs);(void 0!==t?i.length===t:i.length>1)&&i.forEach((e=>{var t=document.getElementById(e).getElementsByClassName("p-datatable");if(1===t.length){(t=t[0]).getBoundingClientRect().width/document.getElementsByClassName("layout-topbar")[0].getBoundingClientRect().width>s.flexs[e]&&Array.from(t.querySelectorAll(".p-datatable table")).forEach((e=>{Array.from(e.classList).join(" ").includes("p-datatable")&&e.style.setProperty("table-layout","auto")}))}}))}(0,l.RegisterImportPool)(h);const c=e=>{const t=(0,l.getExReady)(h,["classNames"]);let s=e.label||e.elem.label;return t.ready?(0,o.jsxs)(i.Fragment,{children:[!e.hide_label&&s&&(0,o.jsxs)(i.Fragment,{children:[(0,o.jsxs)("label",{className:t.classNames.default("l-label","l-span-clickable",{"l-label--unfilled":!e.isFilled}),title:Object.assign({},e.elem.value||{}).quicktip||e.elem.help_text,children:[s,":"]}),(0,o.jsx)("br",{})]}),e.children]}):null};c.propTypes={label:a().string,elem:a().object.isRequired,hide_label:a().bool,isFilled:a().bool,children:a().element.isRequired},c.defaultProps={hide_label:!1,isFilled:!1};class m{static getValueByName({name:e,props:t,context:s}){return t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_PARAMS?s.param_values[e]:t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?s.rows[t.column.rowIndex][e]:t[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_CARDS?s[e]:s.data[e]}}class _ extends l.Component{constructor(e){super(e),this.filled=()=>!["",null,void 0].includes(this.getValue()),this.wrapperClasses=[],this.dataKey=e[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?e.elem.fields_index:e.elem.name,this.upController=e.urlParams.controller,this.c=e.urlParams.controller,this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.getValueByName=this.getValueByName.bind(this),this.innerHTML=this.innerHTML.bind(this),this.setLeafRef=this.setLeafRef.bind(this)}getValueByName(e){return m.getValueByName({name:e,props:this.props,context:this.context})}getValue(){return this.getValueByName(this.dataKey)}innerHTML(e,t={}){let s=this.getValue()||" ";return s instanceof Object&&(s=JSON.stringify(s)),e?(0,o.jsx)("div",{style:t,dangerouslySetInnerHTML:{__html:s}}):(0,o.jsx)("div",{style:t,children:s})}setLeafRef({input:e=!1,type:t=""}={}){this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_DETAIL&&this.upController.dataContext.setLeafRef({name:"slave"===t?this.actorID:this.props.elem.name,ref:this,input:e,type:t})}}_.requiredModules=["classNames"],_.iPool=h,_.contextType=l.DataContextType,_.propTypesFromLinoLayout={column:a().object,editing_mode:a().bool,hide_label:a().bool,[r.URL_PARAM_WINDOW_TYPE]:a().oneOf([r.WINDOW_TYPE_TABLE,r.WINDOW_TYPE_DETAIL,r.WINDOW_TYPE_CARDS,r.WINDOW_TYPE_GALLERIA,r.WINDOW_TYPE_INSERT,r.WINDOW_TYPE_PARAMS,r.WINDOW_TYPE_UNKNOWN]),tabIndex:a().number.isRequired},_.propTypes={..._.propTypesFromLinoLayout,elem:a().object.isRequired,urlParams:a().object.isRequired},_.defaultProps={editing_mode:!1,hide_label:!1,[r.URL_PARAM_WINDOW_TYPE]:r.WINDOW_TYPE_UNKNOWN};class g extends _{constructor(e){super(e),this.liveUpdate=e=>{(null===e.mk||e.mk===this.state.mk&&e.mt===this.state.mt)&&this.update()};const t={};e.hasContext?Object.assign(t,{[r.URL_PARAM_MASTER_PK]:e.urlParams[r.URL_PARAM_MASTER_PK],[r.URL_PARAM_MASTER_TYPE]:e.urlParams[r.URL_PARAM_MASTER_TYPE]}):Object.assign(t,this.upController.actionHandler.masterRelateForSlave()),this.state={...this.state,value:null,data_url:null,...t},this.actorID=e.elem.actor_id||(e.elem.name.includes(".")?e.elem.name:`${e.urlParams.packId}.${e.elem.name}`),this.shouldComponentUpdate=this.shouldComponentUpdate.bind(this),this.getData=this.getData.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}async prepare(){await super.prepare();let e=super.getValue();this.upController.filled(e)&&(this.delayed=e.hasOwnProperty("delayed_value_url"))}onReady(){let e=super.getValue();this.delayed?(this.setLeafRef({type:"slave"}),this.getData(e.delayed_value_url),this.upController.globals.panels[this.actorID]=this):this.setState({value:e})}shouldComponentUpdate(e,t,s){return this.delayed?this.state.value!==t.value||null!==this.state.value&&super.getValue().delayed_value_url!==this.state.data_url:this.state.value!==t.value}componentDidUpdate(e,t){this.delayed?this.state.data_url!==super.getValue().delayed_value_url&&(this.setState({value:null}),this.update()):this.setState({value:super.getValue()})}componentWillUnmount(){delete this.upController.globals.panels[this.actorID]}getValue(){return this.state.value}getData(e){this.upController.actionHandler.silentFetch({path:`${e}?${this.ex.queryString.default.stringify(this.upController.actionHandler.defaultStaticParams())}`}).then((t=>{this.setState({value:t.data,data_url:e})}))}update(){this.getData(super.getValue().delayed_value_url)}}g.requiredModules=["queryString"].concat(_.requiredModules),g.propTypes={..._.propTypes,hasContext:a().bool.isRequired},g.defaultProps={..._.defaultProps,hasContext:!1};class b extends _{constructor(e){super(e),this.onKeyDown=e=>null,this.styleClasses=["disabled-input","l-card","unsaved-modification"],this.componentWillUnmount=this.componentWillUnmount.bind(this),this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.focus=this.focus.bind(this),this.getCellStyleClasses=this.getCellStyleClasses.bind(this),this.getInput=this.getInput.bind(this),this.onChangeUpdate=this.onChangeUpdate.bind(this),this.onInputRef=this.onInputRef.bind(this),this.onRef=this.onRef.bind(this),this.setCellStyle=this.setCellStyle.bind(this),this.submit=this.submit.bind(this),this.tabIndexMatch=this.tabIndexMatch.bind(this),this.update=this.update.bind(this)}async prepare(){this.inputState={inputComponent:this.ex.prInputText.InputText,inputOnly:!1,inputProps:{},onChangeUpdateAssert:e=>!0,postOnChange:e=>null},window.addEventListener("message",u(this))}componentWillUnmount(){window.removeEventListener("message",u(this))}disabled(){if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_CARDS)return!0;if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_PARAMS)return!1;if(!this.props.elem.editable)return!0;if(this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE){let e=this.context.rows[this.props.column.rowIndex],t=e[e.length-1];return!(!t||!t.meta)&&(!!e[e.length-2]||(e[e.length-3][this.props.elem.name]||!1))}return!!this.context.data.disable_editing||(this.context.data.disabled_fields[this.props.elem.name]||!1)}focus(){let e=this.inputEl;e.focus?e.focus():e.focusInput?e.focusInput.focus():e.inputRef&&e.inputRef.current.focus()}getCellStyleClasses(){let e=[];return this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?this.context.modifiedRows[this.props.column.rowIndex].includes(this.props.elem.fields_index)&&e.push("unsaved-modification"):(e.push("l-card"),this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_CARDS&&(this.disabled()?e.push("disabled-input"):this.context.modified.includes(this.props.elem.name)&&e.push("unsaved-modification"))),e}getInput(){return(0,o.jsx)(this.inputState.inputComponent,{onChange:e=>{this.inputState.onChangeUpdateAssert(e)&&(this.onChangeUpdate(e),this.inputState.postOnChange(e))},ref:this.onInputRef,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()||"",...this.inputState.inputProps})}onChangeUpdate(e){this.update({[this.dataKey]:e.target.value}),this.setState({})}onInputRef(e){this.inputEl=e,e&&this.tabIndexMatch()&&this.focus()}onRef(e){const t=()=>{this.container.onclick=e=>{this.disabled()||(Object.assign(this.upController.globals,{currentInputRowIndex:Object.assign({rowIndex:0},this.props.column).rowIndex,currentInputTabIndex:this.props.tabIndex,currentInputWindowType:this.props[r.URL_PARAM_WINDOW_TYPE],currentInputAHRefName:this.upController.actionHandler.refName}),this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_DETAIL||this.props.editing_mode||this.upController.history.replaceState({editing_mode:!0}))}};e&&(this.container=e,this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?(this.container=e.closest("td"),t()):this.props[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_DETAIL&&t()),this.setCellStyle(this.container)}setCellStyle(e){if(e){let t=this.getCellStyleClasses();this.styleClasses.forEach((t=>{e.classList.remove(t)})),t.forEach((t=>{e.classList.add(t)}))}}submit(){this.upController.actionHandler.submit({cellInfo:{rowIndex:this.props.column.rowIndex}})}tabIndexMatch(){return(this.props[r.URL_PARAM_WINDOW_TYPE]!==r.WINDOW_TYPE_TABLE||this.props.column.rowIndex===this.upController.globals.currentInputRowIndex)&&(this.props[r.URL_PARAM_WINDOW_TYPE]===this.upController.globals.currentInputWindowType&&this.upController.actionHandler.refName===this.upController.globals.currentInputAHRefName&&this.props.tabIndex===this.upController.globals.currentInputTabIndex)}update(e){this.upController.actionHandler.update({values:e,elem:this.props.elem,col:this.props.column,windowType:this.props[r.URL_PARAM_WINDOW_TYPE]})}render(e=this.props.hide_label){return this.state.ready?(this.container&&this.setCellStyle(this.container),(0,o.jsx)(c,{...this.props,hide_label:e||this.props.hide_label,elem:this.props.elem,isFilled:this.filled(),children:(0,o.jsx)("div",{className:this.ex.classNames.default(this.wrapperClasses),onKeyDown:this.onKeyDown,ref:this.onRef,children:this.inputState.inputOnly||this.props.editing_mode&&!this.disabled()?this.getInput():this.innerHTML()})})):null}}b.requiredModules=["prInputText"].concat(_.requiredModules);class I extends b{constructor(e){super(e),this.onKeyDown=e=>{13===e.keyCode&&this.inputEl.getOverlay()&&e.stopPropagation()},this.wrapperClasses.push("l-ChoiceListFieldElement"),this.state={...this.state,hidden_value:null},this.dataKeyHidden=e[r.URL_PARAM_WINDOW_TYPE]===r.WINDOW_TYPE_TABLE?e.elem.fields_index_hidden:e.elem.name+"Hidden",this.getInput=this.getInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this)}getValue(){return{text:super.getValue(),value:this.getValueByName(this.dataKeyHidden)}}getInput(){return(0,o.jsx)(this.ex.prDropdown.Dropdown,{onChange:e=>{e.originalEvent.ctrlKey||e.originalEvent.altKey||(this.update({[this.dataKey]:e.value,[this.dataKeyHidden]:e.value}),this.setState({}))},optionLabel:"text",options:this.options,ref:this.onInputRef,showClear:this.props.elem.field_options.allowBlank,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue().value})}innerHTML(){let e=super.getValue()||" ";return(0,o.jsx)("div",{style:{whiteSpace:"nowrap"},children:e})}}I.requiredModules=["prDropdown"].concat(b.requiredModules)},6415:(e,t,s)=>{s.r(t),s.d(t,{DateFieldElement:()=>p,DateFilter:()=>m,TimeFieldElement:()=>c,name:()=>d});s(5247);var i=s(7881),n=s.n(i),a=s(1151),l=s(2756),r=s(6606),o=s(3748);const d="datetime";let h;h={prCalendar:Promise.all([s.e(9109),s.e(8026),s.e(1927),s.e(5573),s.e(7236),s.e(4600),s.e(4292),s.e(8065)]).then(s.bind(s,7698))};(0,r.RegisterImportPool)(h);class u extends l.LeafComponentInput{constructor(e){super(e),this.innerHTML=()=>(0,o.jsx)("div",{children:super.getValue()||" "}),this.isValid=e=>null===e||e instanceof Date||this.str2date(e)instanceof Date,this.getInput=this.getInput.bind(this),this.getValue=this.getValue.bind(this),this.innerHTML=this.innerHTML.bind(this),this.isValid=this.isValid.bind(this),this.updateValue=this.updateValue.bind(this)}getInput(e={}){return(0,o.jsx)(this.ex.prCalendar.Calendar,{...e,className:"l-DateFieldElement",inputMode:this.props.urlParams.controller.globals.isMobile?"numeric":"none",inputStyle:{width:"100%"},keepInvalid:!0,onChange:e=>this.updateValue(e),onClearButtonClick:e=>{e.value=null,this.updateValue(e)},onSelect:e=>this.updateValue(e),ref:this.onInputRef,showButtonBar:!0,showIcon:this.props[a.URL_PARAM_WINDOW_TYPE]!==a.WINDOW_TYPE_TABLE,showOnFocus:!1,style:{width:"100%"},tabIndex:this.props.tabIndex,value:this.getValue()})}getValue(){let e=super.getValue();return this.props.urlParams.controller.filled(e)?this.str2date(e):null}updateValue(e){let t=e.value;this.props.urlParams.controller.filled(t)?t instanceof Date&&(t=this.date2str(t)):t=null,this.container.classList.remove("dangling-modification"),this.container.classList.remove("unsaved-modification"),this.isValid(t)?(this.update({[this.dataKey]:t}),this.setCellStyle(this.container)):this.container.classList.add("dangling-modification")}}u.requiredModules=["prCalendar"].concat(l.LeafComponentInput.requiredModules),u.iPool=Object.assign(h,l.LeafComponentInput.iPool.copy());class p extends u{constructor(e){super(e),this.getInput=()=>super.getInput({dateFormat:"dd.mm.yy",yearNavigator:!0,yearRange:"1900:2900"}),this.date2str=this.date2str.bind(this),this.getInput=this.getInput.bind(this),this.str2date=this.str2date.bind(this)}date2str(e){return("0"+e.getDate()).slice(-2)+"."+("0"+(e.getMonth()+1)).slice(-2)+"."+e.getFullYear()}str2date(e){let t=e.split(".");return 3===t.length&&!t.includes("")&&4===t[2].length&&new Date(t[2],t[1]-1,t[0])}}class c extends u{constructor(e){super(e),this.getInput=()=>super.getInput({hourFormat:"24",showTime:!0,timeOnly:!0}),this.date2str=this.date2str.bind(this),this.getInput=this.getInput.bind(this),this.str2date=this.str2date.bind(this)}date2str(e){return("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}str2date(e){let t=/^(\d(?:\d(?=[.,:; ]?\d\d|[.,:; ]\d|$))?)?[.,:; ]?(\d{0,2})$/g;if(e.match(t)){let s=t.exec(e),i=new Date,n=s[1],a=s[2];return i.setHours(n||0),i.setMinutes(a||0),i}return!1}}class m extends p{constructor(e){super(e),this.filled=()=>this.props.parent.context.controller.filled(this.props.value),this.disabled=()=>!1,this.update=e=>this.props.parent.pushFilter({value:e[this.dataKey]}),this.disabled=this.disabled.bind(this),this.filled=this.filled.bind(this),this.getValue=this.getValue.bind(this),this.update=this.update.bind(this)}getValue(){return this.filled()?this.str2date(this.props.parent.state.value):null}}m.propTypes={parent:n().object.isRequired},m.defaultProps={editing_mode:!0,hide_label:!0}}}]);
//# sourceMappingURL=main.datetime_GridElement.8abdbca07a84911f0b06.js.map