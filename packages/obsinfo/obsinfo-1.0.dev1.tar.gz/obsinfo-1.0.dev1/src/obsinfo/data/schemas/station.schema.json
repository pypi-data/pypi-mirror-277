{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Station",
    "description": "Station deployed by an OBS operator.  Probably never a solo file",
    "type": "object",
    "required": ["format_version", "station"],
    "properties": {
        "format_version": {"$ref": "definitions.schema.json#/format_version"},
        "revision":       {"$ref": "definitions.schema.json#/revision"},
        "notes" :         {"$ref": "definitions.schema.json#/note_list"},
        "station":        {"$ref": "#/definitions/station"}
    },
    "additionalProperties" : false,
    "definitions" : {
        "station" : {
            "type" : "object",
            "description" : "OBS station",
            "if": {
                "required": ["instrumentation"],
                "properties": {
                    "instrumentation": {
                        "description": "fit any type so we can get to next level testing",
                        "type": ["string", "number", "integer", "object",
                                 "array", "boolean", "null"]
                    }
                },
                "additionalProperties": true
            },
            "then": {
                "required": [
                    "start_date",
                    "end_date",
                    "locations",
                    "location_code",
                    "instrumentation"
                ],
                "properties": {
                    "site":                {"$ref": "#/definitions/site"},
                    "start_date":          {"$ref": "definitions.schema.json#/date-time-Z"},
                    "end_date":            {"$ref": "definitions.schema.json#/date-time-Z"},
                    "locations":           {"$ref": "#/definitions/locations_map"},
                    "location_code":       {"$ref": "#/definitions/location_code"},
                    "operators":           {"$ref": "operator.schema.json#/definitions/operators"},
                    "processing":          {"$ref": "#/definitions/processing_list"},
                    "notes" :              {"$ref": "definitions.schema.json#/note_list"},
                    "comments":            {"$ref" : "definitions.schema.json#/comments"},
                    "extras":              {"$ref" : "definitions.schema.json#/extras"},
                    "source_id":           {"$ref": "definitions.schema.json#source_id"},
                    "external_references": {"$ref": "definitions.schema.json#external_references"},
                    "instrumentation":     {"$ref": "instrumentation_base.schema.json#/definitions/instrumentation"},
                    "identifiers":         {"$ref": "definitions.schema.json#identifiers"},
                    "water_level.m":       {"type": "number"},
                    "description":         {"type": "string"},
                    "restricted_status":   {"$ref": "definitions.schema.json#/restricted_status"}
                },
                "additionalProperties": false
            },
            "else": {
                "required": [
                    "start_date",
                    "end_date",
                    "locations",
                    "location_code",
                    "instrumentations"
                ],
                "properties": {
                    "site":                {"$ref": "#/definitions/site"},
                    "start_date":          {"$ref": "definitions.schema.json#/date-time-Z"},
                    "end_date":            {"$ref": "definitions.schema.json#/date-time-Z"},
                    "locations":           {"$ref": "#/definitions/locations_map"},
                    "location_code":       {"$ref": "#/definitions/location_code"},
                    "instrumentations":    {"$ref": "#/definitions/instrumentation_list"}, 
                    "operators":           {"$ref": "operator.schema.json#/definitions/operators"},
                    "processing":          {"$ref": "#/definitions/processing_list"},
                    "notes" :              {"$ref": "definitions.schema.json#/note_list"},
                    "comments":            {"$ref" : "definitions.schema.json#/comments"},
                    "extras":              {"$ref" : "definitions.schema.json#/extras"},
                    "source_id":           {"$ref": "definitions.schema.json#source_id"},
                    "external_references": {"$ref": "definitions.schema.json#external_references"},
                    "identifiers":         {"$ref": "definitions.schema.json#identifiers"},
                    "water_level.m":       {"type": "number"},
                    "description":         {"type": "string"},
                    "restricted_status":   {"$ref": "definitions.schema.json#/restricted_status"}
                },
                "additionalProperties": false
            }
        },
        "site": {
            "if": {"type": "string"},
            "then": {
                "description": "will be injected into site:name"
            },
            "else": {
                "type" : "object", 
                "required": ["name"],
                "description": "Site object",
                "properties" : {
                    "name":        {"type": "string"},
                    "description": {"type": "string"},
                    "town":        {"type": "string"},
                    "county":      {"type": "string"},
                    "region":      {"type": "string"},
                    "country":     {"type": "string"}
                }
            }
        },
        "location_code" : {
            "type" : "string",
            "description" : "SEED location code, empty or 2-number string",
            "pattern" : "^(.{0}|[0-9]{2})$"
        },
        "locations_map" : {
            "type" : "object",
            "description" : "sensor position by location code (two digits or empty)",
            "patternProperties": {
                "^(.{0}|[0-9]{2})$": { "$ref": "location_base.schema.json#/definitions/location" }
            }
        },
        "instrumentation_list": {
           "type": "array",
           "description":" list of instrumentation",
           "minItems" : 1,
           "items" : {"$ref": "instrumentation_base.schema.json#/definitions/instrumentation"}
        },
                
        "processing_list": {
            "type": "array",
            "description": "other information",
            "items": {
                "type": "object",
                "description": "other informations that will be appear as comments ",
                "properties": {
                    "clock_correction_linear": {"$ref": "timing_base.schema.json#/definitions/timing"},
                    "clock_correction_leapsecond":   {"$ref": "#/definitions/clock_correction_leapsecond"}
                },
                "additionalProperties" : false
            }
        },
        "clock_correction_leapsecond" : {
                "type" : "object",
                "description" : "Leap-second information",
                "required" : ["time", "type", "corrected_in_end_sync"],
                "properties" : {
                    "time" :                 {"$ref": "definitions.schema.json#/date-time-Z" },
                    "type" :                 {"$ref": "#/definitions/lpsec_type"},
                    "description" :          {"$ref": "#/definitions/lpsec_description" },
                    "corrected_in_end_sync": {"$ref": "#/definitions/lpsec_corrected_in_end_sync"},
                    "corrected_in_basic_miniseed": {"$ref": "#/definitions/lpsec_corrected_in_basic_miniseed" }
                },
                "additionalProperties": false
        },
       "lpsec_type" : {
            "type" : "string",
            "description" : "Leapsecond direction",
            "enum" : ["+","-"]
        },
        "lpsec_description" : {
            "type": "string",
            "enum": [
                "Positive leapsecond (a 61-second minute)",
                "Negative leapsecond (a 59-second minute)"
            ]
        },
        "lpsec_corrected_in_end_sync" : {
            "type": "boolean",
            "description": "True if end_sync_instrument was corrected for the leap second (subtracted one second if positive leapsecond, added one if negative)"
        },
        "lpsec_corrected_in_basic_miniseed" : {
            "type": "boolean",
            "description": "True if basic miniseed data is already corrected for the leap second"
        }
    }
}
