import{n as b,r as p,z as f,A as h,w as l,B as V,o as C,a as u,b as c,d,v as y,D as x,E,u as v,G as U,y as k}from"./entry.wJW_9yny.js";import{r as B,b as R,c as T,a as A}from"./form-methods.CS9pXFl6.js";const q={style:{"max-width":"30rem"}},I=u("h1",{class:"section-header"},"Login to MLTE",-1),L={class:"margin-button centered-container"},M=b({__name:"login",setup(N){const g=k(),a=p(""),s=p("");async function w(){const i={grant_type:"password",username:a.value,password:s.value};let t=[];for(const e in i){const n=encodeURIComponent(e),r=encodeURIComponent(i[e]);t.push(n+"="+r)}t=t.join("&");try{await $fetch(g.public.apiPath+"/token",{retry:0,method:"POST",headers:{accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:t,onRequestError({request:e}){console.log(e),B()},onResponse({response:e}){var o,m,_;const n=v("token",{Secure:!0,maxAge:(o=e==null?void 0:e._data)==null?void 0:o.expires_in}),r=v("user",{maxAge:(m=e==null?void 0:e._data)==null?void 0:m.expires_in});n.value=(_=e==null?void 0:e._data)==null?void 0:_.access_token,r.value=a.value,U("/")},onResponseError({response:e}){e.status===400?R(e._data.error_description):e.status===409?T():A()}})}catch(e){console.log("Error in fetch."),console.log(e)}}return(i,t)=>{const e=f("UsaTextInput"),n=f("UsaButton"),r=V;return C(),h(r,{name:"base-layout"},{default:l(()=>[u("form",null,[u("div",q,[I,c(e,{modelValue:y(a),"onUpdate:modelValue":t[0]||(t[0]=o=>x(a)?a.value=o:null),required:"",type:"text"},{label:l(()=>[d(" Username ")]),_:1},8,["modelValue"]),c(e,{modelValue:y(s),"onUpdate:modelValue":t[1]||(t[1]=o=>x(s)?s.value=o:null),required:"",type:"password"},{label:l(()=>[d(" Password ")]),_:1},8,["modelValue"]),u("div",L,[c(n,{type:"submit",class:"primary-button",onClick:t[2]||(t[2]=E(o=>w(),["prevent"]))},{default:l(()=>[d(" Login ")]),_:1})])])])]),_:1})}}});export{M as default};
