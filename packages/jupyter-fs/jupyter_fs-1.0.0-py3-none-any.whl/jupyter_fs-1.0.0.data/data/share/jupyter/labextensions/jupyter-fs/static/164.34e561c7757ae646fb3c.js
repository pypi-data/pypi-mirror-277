"use strict";(self.webpackChunkjupyter_fs=self.webpackChunkjupyter_fs||[]).push([[164],{2164:(e,t,n)=>{n.r(t),n.d(t,{browser:()=>xe,default:()=>Ee,progressStatus:()=>De});var r=n(6053),s=n(3578),o=n(7212),i=n(9408),a=n(2857),l=n(2741),d=n(5865),c=n(9820),u=n(7717),h=n(8778),p=n(6214),m=n(6697),f=n(7930),g=n(9976);async function*v(e,t){const n=e.join("/");if(!n.startsWith(t.pathstr))throw new Error(`Path ${n} not in ${t.pathstr}`);let r=t;yield r;for(let s=t.row.path.length;s<e.length;++s){const t=await r.getChildren(),o=null==t?void 0:t.find((t=>t.name===e[s]));if(!o)throw new Error(`Path ${n} not in ${r.pathstr}`);r=o,yield r}}async function w(e,t){let n;for await(n of v(t,e.root))!n.isExpand&&n.hasChildren&&await n.expand();return n}async function y(e,t,n){const r=await w(e,t);return e.selectionModel.select(r,n),r}async function _(e,t){for await(const n of v(t,e.root))n.pathstr!==e.root.pathstr&&await e.openDir(n.row)}async function b(e,t){let n;for await(n of v(e.row.path.slice(0,-1),t));return n}function x(e,t,n=!1){const r=t.row.path.length+(n?1:0);if(!e.some((e=>e.path.length<=r+(e.getChildren?0:1))))return n?e.map((e=>({...e,getChildren:void 0}))):e}function C(e){const t=e.indexOf("/");return-1===t?[e,""]:[e.slice(0,t),e.slice(t+1).replace(/^[/]*/,"")]}class D{constructor(e){this._model=new p.ClipboardModel,this._drive=new g.Drive,this._tracker=e,this._model.deleteSub.subscribe((async e=>{await Promise.all(e.map((e=>this._onDelete(e))));const t=this._tracker.currentWidget.treefinder.model,n=x(e,t.root,!0);this.model.refresh(t,n)})),this._model.pasteSub.subscribe((async({destination:e,doCut:t,memo:n})=>{const r="dir"===e.kind?e.path:e.path.slice(0,-1),s=p.Path.fromarray(r);await Promise.all(n.map((e=>this._onPaste(e,s,t))));const o=this._tracker.currentWidget.treefinder.model;let i=x([e],o.root,!1);if(t&&void 0!==i){const e=x(n,o.root,!1);void 0===e?i=void 0:i.push(...e)}this.model.refresh(o,i)}))}refresh(e,t){null!=e||(e=this._tracker.currentWidget.treefinder.model),this.model.refresh(e,t)}refreshSelection(e){this.refresh(e,e.selection.map((e=>e.row)))}get model(){return this._model}async _onDelete(e){const t=p.Path.fromarray(e.path);try{await this._drive.delete(t)}catch(e){await(0,s.showErrorMessage)("Delete Failed",e)}}async _onPaste(e,t,n){const r=p.Path.fromarray(e.path);try{await this._drive.copy(r,t),n&&await this._drive.delete(r)}catch(e){await(0,s.showErrorMessage)("Paste Error",e)}}}class E{constructor(e,t,n){this.contentsManager=e,this.drive=t,this.onGetChildren=n}async get(e,t){return e=E.toFullPath(e,this.drive),E.toJupyterContentRow(await this.contentsManager.get(e,t),this.contentsManager,this.drive,this.onGetChildren)}async save(e,t){return e=E.toFullPath(e,this.drive),E.toJupyterContentRow(await this.contentsManager.save(e,t),this.contentsManager,this.drive,this.onGetChildren)}async rename(e,t){return e=E.toFullPath(e,this.drive),t=E.toFullPath(t,this.drive),E.toJupyterContentRow(await this.contentsManager.rename(e,t),this.contentsManager,this.drive,this.onGetChildren)}async newUntitled(e){return e.path=e.path&&E.toFullPath(e.path,this.drive),E.toJupyterContentRow(await this.contentsManager.newUntitled(e),this.contentsManager,this.drive,this.onGetChildren)}async downloadUrl(e){return e=E.toFullPath(e,this.drive),await this.contentsManager.getDownloadUrl(e)}}!function(e){function t(e,t){return!t||e.startsWith(`${t}:`)?e.startsWith(`${t}:/`)?e.replace(`${t}:/`,`${t}:`):e:e.startsWith(`${t}/`)?[t,e.slice(t.length+1)].join(":"):[t,e].join(":")}e.toFullPath=t,e.toLocalPath=function(e){const[t,...n]=e.split("/");return[t.split(":").pop(),...n].join("/")},e.toJupyterContentRow=function e(n,r,o,i){const{path:a,type:l,...d}=n,c=t(a,o).replace(/\/$/,""),u="directory"===l?"dir":l;return{path:p.Path.toarray(c),kind:u,...d,..."dir"===u?{getChildren:async()=>{let t;const n=new f.PromiseDelegate;if(i){const e=p.Path.toarray(c).join("/");i(e,n.promise)}try{t=await r.get(c,{content:!0}),n.resolve()}catch(e){return(0,s.showErrorMessage)("Failed to get directory contents",e),n.reject("Failed to get directory contents"),[]}return t.content.map((t=>e(t,r,o,i)))}}:{}}}}(E||(E={}));var k=n(5359);const j="jfs-DropWidget",P="jfs-DragWidget",S="jfs-mod-dragHandle",I="jfs-mod-dropTarget",L="application/x-jupyterfs-thead";function M(e,t,n){let r=e;for(;r&&!r.classList.contains(t);)r=r.parentElement;return!!r&&r===n}class T extends h.Widget{constructor(e={}){var t;super(e),this.acceptDropsFromExternalSource=!0===e.acceptDropsFromExternalSource,this.addClass(j),this.acceptedDropMimeTypes=null!==(t=e.acceptedDropMimeTypes)&&void 0!==t?t:[]}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this.evtDrop(e)}}validateSource(e){return this.acceptDropsFromExternalSource||e.source===this}findDropTarget(e,t){return this.acceptedDropMimeTypes.some((e=>t.hasData(e)))&&this._isValidTargetHeader(e,t.getData(L))?(e.classList.add(I),t.types().includes(L)?e:function(e,t){const n=Array.isArray(e);let r=t,s=null;for(;r&&r!==e;){if(o=r,n?e.indexOf(o)>-1:o.parentElement===e){s=r;break}r=r.parentElement}var o;return s}(this.node,e)):null}evtDrop(e){let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(I)){t.classList.remove(I);break}t=t.parentElement}if(t&&M(t,j,this.node))return this.validateSource(e)?void this.processDrop(t,e):(e.dropAction="none",e.preventDefault(),void e.stopPropagation())}onAfterAttach(e){const t=this.node;t.addEventListener("lm-dragenter",this),t.addEventListener("lm-dragleave",this),t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this)}onBeforeDetach(e){const t=this.node;t.removeEventListener("lm-dragenter",this),t.removeEventListener("lm-dragleave",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}_evtDragEnter(e){if(!this.validateSource(e))return;const t=this.findDropTarget(e.target,e.mimeData);null!==t&&(this._clearDropTarget(),t.classList.add(I),e.preventDefault(),e.stopPropagation())}_evtDragLeave(e){e.preventDefault(),e.stopPropagation(),this._clearDropTarget()}_evtDragOver(e){this.validateSource(e)&&(this._clearDropTarget(),null!==this.findDropTarget(e.target,e.mimeData)&&(e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction))}_isValidTargetHeader(e,t){return e.classList.contains("tf-header-name")&&e.innerText!==t&&"path"!==e.innerText}_clearDropTarget(){const e=this.node.getElementsByClassName(I);e.length&&e[0].classList.remove(I)}}class R extends T{constructor(e={}){super(e),this.drag=null,this.dragHandleClass=S,this.defaultSupportedActions="all",this.defaultProposedAction="move",this._clickData=null,this.addClass(P)}dispose(){this.drag=null,this._clickData=null,super.dispose()}handleEvent(e){switch(e.type){case"mousedown":this._evtDragMousedown(e);break;case"mouseup":this._evtDragMouseup(e);break;case"mousemove":this._evtDragMousemove(e);break;default:super.handleEvent(e)}}findDragTarget(e){return e}getDragImage(e){const t=this.findDragTarget(e);return t?t.cloneNode(!0):null}onDragComplete(e){this.drag=null}onAfterAttach(e){this.node.addEventListener("mousedown",this),super.onAfterAttach(e)}onBeforeDetach(e){const t=this.node;t.removeEventListener("click",this),t.removeEventListener("dblclick",this),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),super.onBeforeDetach(e)}startDrag(e,t,n){const r=this.getDragImage(e);this.drag=new k.Drag({dragImage:r||void 0,mimeData:new f.MimeData,supportedActions:this.defaultSupportedActions,proposedAction:this.defaultProposedAction,source:this}),this.addMimeData(e,this.drag.mimeData),this.drag.start(t,n).then((e=>this.onDragComplete(e))),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)}_findDragHandle(e){let t=null,n=e;for(;n&&n!==this.node;){if(n.classList.contains(this.dragHandleClass)){t=n;break}n=n.parentElement}return null===t||M(t,P,this.node)||(t=null),t}_evtDragMousedown(e){const t=e.target,n=this._findDragHandle(t);null!==n&&0===e.button&&(this._clickData={pressX:e.clientX,pressY:e.clientY,handle:n},document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault())}_evtDragMouseup(e){if(0!==e.button||!this.drag)return document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),void(this.drag=null);e.preventDefault(),e.stopPropagation()}_evtDragMousemove(e){if(this.drag)return;e.preventDefault(),e.stopPropagation();const t=this._clickData;if(!t)throw new Error("Missing drag data");const n=Math.abs(e.clientX-t.pressX),r=Math.abs(e.clientY-t.pressY);n<5&&r<5||(this.startDrag(t.handle,e.clientX,e.clientY),this._clickData=null)}}class A extends R{constructor(e={}){super(e)}processDrop(e,t){}findDropTarget(e,t){return null}}class F extends R{processDrop(e,t){if(!T.isValidAction(t.supportedActions,"move")||"none"===t.proposedAction)return t.dropAction="none",t.preventDefault(),void t.stopPropagation();if(!this.validateSource(t))throw new Error("Invalid source!");const n=this.move(t.mimeData,e);t.preventDefault(),t.stopPropagation(),t.dropAction=n}}!function(e){e.isValidAction=function(e,t){switch(e){case"all":return!0;case"link-move":return"move"===t||"link"===t;case"copy-move":return"move"===t||"copy"===t;case"copy-link":return"link"===t||"copy"===t;default:return t===e}}}(T||(T={})),function(e){function t(e){e.addClass(S)}e.makeHandle=t,e.unmakeHandle=function(e){e.removeClass(S)},e.createDefaultHandle=function(){const e=new h.Widget;return e.addClass("jfs-DragWidget-dragHandle"),t(e),e}}(A||(A={})),new d.LabIcon({name:"jfs:drive",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24" height="24" viewBox="0 0 24 24" fill="none">\n  <path class="jp-icon3 jp-icon-selectable" stroke="#616161" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M22 12H2M5.45 5.11L2 12v6a2 2 0 002 2h16a2 2 0 002-2v-6l-3.45-6.89A2 2 0 0016.76 4H7.24a2 2 0 00-1.79 1.11zM6 16h.01M10 16h.01"/>\n</svg>\n'});const W=new d.LabIcon({name:"jfs:file-tree",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="20" viewBox="0 0 16 16">\n  <path class="jp-icon3" fill="#616161" d="M16 10V6H5v1H3V4h9V0H0v4h2v10h3v2h11v-4H5v1H3V8h2v2z"/>\n</svg>\n'}),$=(new d.LabIcon({name:"jfs:jupyter-fs",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="500" viewBox="0 0 100 100">\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="9.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="20" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="20" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="39.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="50" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="50" r="3"/>\n\n  <rect class="jp-icon3" stroke="#616161" stroke-width="4" width="91" height="21" fill="none" rx="4" x="4.5" y="69.5"/>\n  <circle class="jp-icon3" fill="#616161" cx="85" cy="80" r="3"/>\n  <circle class="jp-icon3" fill="#616161" cx="73" cy="80" r="3"/>\n</svg>\n'}),new d.LabIcon({name:"jfs:visibility",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>\n</svg>'})),V=new d.LabIcon({name:"jfs:visibility-off",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">\n  <path class="jp-icon3" fill="#616161" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>\n</svg>'});var O=n(858);n(8641),new RegExp(`^${O.PageConfig.getOption("treeUrl")}([^?]+)`),new RegExp(`^${O.PageConfig.getOption("workspacesUrl")}[^?/]+/tree/([^?]+)`);var N=n(4901);const U=1048576;class B extends s.ToolbarButton{constructor(e){super({icon:d.fileUploadIcon,label:e.label,onClick:()=>{this._input.click()},tooltip:z.translateToolTip(e.translator)}),this._onInputChanged=()=>{const e=Array.prototype.slice.call(this._input.files).map((async e=>(await this._uploader).upload(e)));Promise.all(e).catch((e=>{(0,s.showErrorMessage)(this._trans._p("showErrorMessage","Upload Error"),e)}))},this._onInputClicked=()=>{this._input.value=""},this._input=z.createUploadInput(),this.translator=e.translator||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._uploader=e.uploader,this._input.onclick=this._onInputClicked,this._input.onchange=this._onInputChanged,this.addClass("jp-id-upload")}}class q{constructor(e){this._uploads=[],this._uploadChanged=new N.Signal(this),this._uploadCompleted=new N.Signal(this),this._disposed=!1,this.model=e.model,this._contentsProxy=e.contentsProxy}get uploadChanged(){return this._uploadChanged}get uploadCompleted(){return this._uploadCompleted}get isDisposed(){return this._disposed}dispose(){this.isDisposed||(this._disposed=!0,N.Signal.clearData(this))}async upload(e,t){await this._uploadCheckDisposed(),(t=t||this.model.selectedLast||this.model.root).hasChildren||(t=await b(t,this.model.root));const n=t.pathstr?t.pathstr+"/"+e.name:e.name;let r=null;try{r=await this._contentsProxy.get(n,{content:!1})}catch(e){}if(r&&!await(0,o.shouldOverwrite)(n.slice(n.indexOf("/")+1)))return null;await this._uploadCheckDisposed();const s=e.size>U,i=await this._upload(e,n,s);return t.invalidate(),this._uploadCompleted.emit({path:i.path}),i}async _upload(e,t,n){const r=e.name,s=async(n,s)=>{await this._uploadCheckDisposed();const o=new FileReader;o.readAsDataURL(n),await new Promise(((t,n)=>{o.onload=t,o.onerror=t=>n(`Failed to upload "${e.name}":  ${t}`)})),await this._uploadCheckDisposed();const i=o.result.split(",")[1],a={type:"file",format:"base64",name:r,chunk:s,content:i};return await this._contentsProxy.save(t,a)};if(!n)try{return await s(e)}catch(t){throw m.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path)),t}let o,i={path:t,progress:0};this._uploadChanged.emit({name:"start",newValue:i,oldValue:null});for(let n=0;!o;n+=U){const r=n+U,a=r>=e.size,l=a?-1:r/U,d={path:t,progress:n/e.size};let c;this._uploads.splice(this._uploads.indexOf(i)),this._uploads.push(d),this._uploadChanged.emit({name:"update",newValue:d,oldValue:i}),i=d;try{c=await s(e.slice(n,r),l)}catch(t){throw m.ArrayExt.removeFirstWhere(this._uploads,(t=>e.name===t.path)),this._uploadChanged.emit({name:"failure",newValue:i,oldValue:null}),t}a&&(o=c)}return this._uploads.splice(this._uploads.indexOf(i)),this._uploadChanged.emit({name:"finish",newValue:null,oldValue:i}),o}_uploadCheckDisposed(){return this.isDisposed?Promise.reject("Filemanager disposed. File upload canceled"):Promise.resolve()}}var z;!function(e){e.createUploadInput=function(){const e=document.createElement("input");return e.type="file",e.multiple=!0,e},e.translateToolTip=function(e){return(e=e||l.nullTranslator).load("jupyterlab").__("Upload Files")}}(z||(z={}));class H extends s.WidgetTracker{constructor(){super(...arguments),this._finders=new Map}async add(e){return this._finders.set(e.id,e),e.disposed.connect(this._onWidgetDisposed,this),super.add(e)}remove(e){this._finders.delete(e.id),e.disposed.disconnect(this._onWidgetDisposed,this)}findByDrive(e){return this._finders.get(e)}hasByDrive(e){return this._finders.has(e)}_onWidgetDisposed(e){this.remove(e)}}class G extends F{constructor({app:e,columns:t,rootPath:n="",translator:r,settings:o}){const{commands:i,serviceManager:{contents:a}}=e;super({node:document.createElement("tree-finder-panel"),acceptedDropMimeTypes:[L]}),this.addClass("jp-tree-finder"),this.contentsProxy=new E(a,n,this.onGetChildren.bind(this)),this.settings=o,this.translator=r||l.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._commands=i,this._expanding=new Map,this._columns=t,this.rootPath=""===n?n:n+":",this._initialLoad=!0,this._readyDelegate=new f.PromiseDelegate,this._readyDelegate.promise.catch((e=>(0,s.showErrorMessage)("Failed to init browser",e))),this._readyDelegate.promise.then((()=>{const e=this.model;e.renamerSub.subscribe((({name:t,target:n})=>{e.sort()}))}))}move(e,t){const n=e.getData(L),r=t.innerText;return this._reorderColumns(n,r),this.nodeInit(),"move"}addMimeData(e,t){const n=e.innerText;t.setData(L,n)}getDragImage(e){const t=this.findDragTarget(e);let n=null;return t&&(n=t.cloneNode(!0),n.classList.add("jp-thead-drag-image")),n}onGetChildren(e,t){if(this._initialLoad){const n=p.Path.toarray(this.rootPath).join("/");e===n&&t.finally((()=>{this._initialLoad=!1,this.draw()}))}this._expanding.set(e,(this._expanding.get(e)||0)+1),1===this._expanding.get(e)&&this.draw(),t.finally((()=>{this._expanding.set(e,(this._expanding.get(e)||1)-1),0===this._expanding.get(e)&&this.draw()}))}async _reorderColumns(e,t){var n;const r=this._columns.indexOf(e),s=this._columns.indexOf(t);r<s?(this._columns.splice(s+1,0,e),this._columns.splice(r,1)):r>s&&(this._columns.splice(r,1),this._columns.splice(s,0,e)),await(null===(n=this.settings)||void 0===n?void 0:n.set("display_columns",this._columns))}draw(){var e;null===(e=this.model)||void 0===e||e.requestDraw()}refresh(){var e;null===(e=this.model)||void 0===e||e.refreshSub.next()}async nodeInit(){var e;const t=await this.contentsProxy.get(this.rootPath,{content:!1});this._currentFolder=null===(e=this.model)||void 0===e?void 0:e.root.pathstr,await this.node.init({root:t,gridOptions:{columnFormatters:{last_modified:e=>p.Format.timeSince(e),size:e=>e&&p.Format.bytesToHumanReadable(e),writable:e=>e?"✓":"╳"},doWindowResize:!0,showFilter:!0},modelOptions:{columnNames:this.columns}});const n=this.node.querySelector("tree-finder-grid");null==n||n.addStyleListener((()=>{var e,t,r;n.classList.toggle("jfs-mod-loading",this._initialLoad);const s=n.querySelectorAll("thead tr > th:first-child > span.rt-column-resize"),o=n.querySelectorAll("thead tr").length;if(s.length>o)for(const e of n.querySelectorAll("thead tr > th:first-child > span.rt-column-resize:first-child"))e.removeAttribute("class");let i=(null===(e=this.model)||void 0===e?void 0:e.selectedLast)?null===(t=this.model)||void 0===t?void 0:t.contents.indexOf(this.model.selectedLast):-1;const a=document.activeElement===document.body;for(const e of n.querySelectorAll("tr > th")){const t=e.querySelector("span.tf-header-name");t&&"path"!==t.innerText&&t.classList.add(this.dragHandleClass);const s=e.querySelector("span.rt-group-name");if(null==s||s.setAttribute("tabindex","0"),a&&s&&-1!==i){const t=n.getMeta(e);t&&t.y===i&&(s.focus(),i=-1)}if(s){const t=n.getMeta(e),o=(null==t?void 0:t.y)?null===(r=this.model)||void 0===r?void 0:r.contents[t.y]:void 0;o&&e.classList.toggle("jfs-mod-loading",!!s&&(this._expanding.get(o.pathstr)||0)>0)}}})),this.uploader?this.uploader.model=this.model:this.uploader=new q({contentsProxy:this.contentsProxy,model:this.model}),this._currentFolder&&await _(this.model,this._currentFolder.split("/")),this.model.openSub.subscribe((e=>e.forEach((e=>{if(e.getChildren){const e=J.tracker.findByDrive(this.parent.id);J.tracker.save(e)}else this._commands.execute("docmanager:open",{path:p.Path.fromarray(e.path)})}))))}get columns(){return this._columns}set columns(e){if(m.ArrayExt.shallowEqual(this._columns,e))return;this._columns=e;const t=this.model;t.options={...t.options,columnNames:this._columns},t.initColumns(),this.nodeInit()}get ready(){return this._readyDelegate.promise}get model(){return this.node.model}get selection(){var e;return null===(e=this.model)||void 0===e?void 0:e.selection}get selectionPathstrs(){var e;return null===(e=this.model)||void 0===e?void 0:e.selection.map((e=>p.Path.fromarray(e.row.path)))}handleEvent(e){switch(e.type){case"keydown":this.evtKeydown(e);break;case"dragenter":this.evtNativeDragOverEnter(e);case"dragover":this.evtNativeDragOverEnter(e);break;case"dragleave":case"dragend":this.evtNativeDragLeaveEnd(e);break;case"drop":this.evtNativeDrop(e);break;default:super.handleEvent(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node,n=this.nodeInit();this._initialLoad&&n.then((()=>{this._readyDelegate.resolve()})),t.addEventListener("keydown",this),t.addEventListener("dragenter",this),t.addEventListener("dragover",this),t.addEventListener("dragleave",this),t.addEventListener("dragend",this),t.addEventListener("drop",this)}onBeforeDetach(e){super.onBeforeDetach(e);const t=this.node;t.removeEventListener("keydown",this),t.removeEventListener("dragover",this),t.removeEventListener("dragover",this),t.removeEventListener("dragleave",this),t.removeEventListener("dragend",this),t.removeEventListener("drop",this)}_findEventRowElement(e,t){let n=e.target;for(;n.parentElement&&n.parentElement!==this.node;){if(n.matches(t))return n;n=n.parentElement}}selectNeighbour(e,t){const n=this.model;let r=n.selectedLast;const{range:s,pivot:o}=n.selectionModel;if(o&&o===(null==r?void 0:r.pathstr)&&s&&s.length>=1){const e=n.contents.map((e=>e.pathstr)),t=e.indexOf(o),i=e.indexOf(s[0]),a=e.indexOf(s[s.length-1]);r=t<i?n.contents[a]:n.contents[i]}let i=r?n.contents.indexOf(r):e<0?n.contents.length-1:0;if(r&&(i+=e),i<0||i>=n.contents.length)return;const a=n.contents[i];t?n.selectionModel.selectRange(a,n.contents):n.selectionModel.select(a),J.scrollIntoView(this,a.pathstr)}evtKeydown(e){var t,n,r,s;if(!(null===(t=this.parent)||void 0===t?void 0:t.node.classList.contains("jfs-mod-renaming")))switch(e.key){case"ArrowDown":case"ArrowUp":e.stopPropagation(),e.preventDefault(),this.selectNeighbour("ArrowUp"===e.key?-1:1,e.shiftKey);break;case"ArrowLeft":if(null===(n=this.model)||void 0===n?void 0:n.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;e.shiftKey||(t.isExpand?this.model.collapse(this.model.contents.indexOf(t)):b(t,this.model.root).then((e=>{var t,n;if(e!==(null===(t=this.model)||void 0===t?void 0:t.root))return null===(n=this.model)||void 0===n||n.selectionModel.select(e),J.scrollIntoView(this,e.pathstr)})))}break;case"ArrowRight":if(null===(r=this.model)||void 0===r?void 0:r.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;e.shiftKey||(t.isExpand?t.hasChildren&&t.getChildren().then((e=>{var t;if(e&&e.length>0)return null===(t=this.model)||void 0===t||t.selectionModel.select(e[0]),J.scrollIntoView(this,e[0].pathstr)})):this.model.expand(this.model.contents.indexOf(t)))}break;case" ":if(null===(s=this.model)||void 0===s?void 0:s.selectedLast){e.stopPropagation(),e.preventDefault();const t=this.model.selectedLast;if(t.hasChildren){const e=this.model.contents.indexOf(t);t.isExpand?this.model.collapse(e):this.model.expand(e)}}}}evtNativeDragOverEnter(e){const t=this._findEventRowElement(e,"tree-finder-grid tr");t&&t.classList.add("jfs-mod-native-drop"),e.preventDefault()}evtNativeDragLeaveEnd(e){const t=this._findEventRowElement(e,".jfs-mod-native-drop");t&&t.classList.remove("jfs-mod-native-drop")}evtNativeDrop(e){var t,n,r;const o=this.node.querySelector(".jfs-mod-native-drop");o&&o.classList.remove("jfs-mod-native-drop");const i=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;if(!i||0===i.length)return;const a=null===(n=e.dataTransfer)||void 0===n?void 0:n.items.length;if(!a)return;for(let t=0;t<a;t++){const n=null===(r=e.dataTransfer)||void 0===r?void 0:r.items[t].webkitGetAsEntry();(null==n?void 0:n.isDirectory)&&(0,s.showDialog)({title:this._trans.__("Error Uploading Folder"),body:this._trans.__("Drag and Drop is currently not supported for folders"),buttons:[s.Dialog.cancelButton({label:this._trans.__("Close")})]})}e.preventDefault();let l=this.model.root;if(o){const e=this.node.querySelector("tree-finder-grid").getMeta(o.querySelector("th"));e.y&&(l=this.model.contents[e.y])}for(let e=0;e<i.length;e++)this.uploader.upload(i[e],l)}}class J extends h.Widget{constructor({app:e,columns:t,url:n,rootPath:r="",caption:o="TreeFinder",id:i="jupyterlab-tree-finder",settings:a,preferredDir:l}){super(),this.id=i,this.node.classList.add("jfs-mod-notRenaming"),this.url=n,this.title.icon=W,this.title.caption=o,this.addClass("jp-tree-finder-sidebar"),this.toolbar=new s.Toolbar,this.toolbar.addClass("jp-tree-finder-toolbar"),this.preferredDir=l,this.treefinder=new G({app:e,rootPath:r,columns:t,settings:a}),this.layout=new h.PanelLayout,this.layout.addWidget(this.toolbar),this.layout.addWidget(this.treefinder)}restore(){this.treefinder.ready.then((()=>this.treefinder.refresh()))}async download(e,t){if(t);else{const t=await this.treefinder.contentsProxy.downloadUrl(e),n=document.createElement("a");n.setAttribute("href",t),n.setAttribute("download",""),document.body.appendChild(n),n.click(),document.body.removeChild(n)}}onBeforeShow(e){this.treefinder.refresh(),this.treefinder.draw()}onResize(e){this.treefinder.draw()}}!function(e){function t({app:t,restorer:n,url:r,columns:o,settings:i,preferredDir:a,rootPath:l="",caption:c="TreeFinder",id:u="jupyterlab-tree-finder",side:h="left"}){const p=new e({app:t,rootPath:l,columns:o,caption:c,id:u,url:r,settings:i,preferredDir:a});p.treefinder.ready.then((()=>e.tracker.add(p))),t.shell.add(p,h);const m=new s.ToolbarButton({icon:d.newFolderIcon,onClick:()=>{t.commands.execute(te.create_folder)},tooltip:"New Folder"}),f=new B({uploader:p.treefinder.ready.then((()=>p.treefinder.uploader))});p.treefinder.ready.then((()=>{p.treefinder.uploader.uploadCompleted.connect(((e,t)=>{w(p.treefinder.model,t.path).then((()=>p.treefinder.model.flatten()))}))}));const g=new s.ToolbarButton({icon:d.refreshIcon,onClick:()=>{t.commands.execute(te.refresh)},tooltip:"Refresh"});return p.toolbar.addItem("new file",m),p.toolbar.addItem("upload",f),p.toolbar.addItem("refresh",g),a&&p.treefinder.ready.then((async()=>{let e=a.split("/");a.startsWith("/")&&(e=e.slice(1)),e.unshift(l),await _(p.treefinder.model,e)})),p}e.tracker=new H({namespace:"jupyter-fs-treefinder"}),e.clipboard=new D(e.tracker),e.sidebarFromResource=function(e,n){return t({...n,rootPath:e.drive,caption:`${e.name}\nFile Tree`,id:re(e),preferredDir:e.preferred_dir,url:e.url})},e.sidebar=t,e.doRename=async function(e,t){var n;if(e.node.classList.contains("jfs-mod-renaming"))return t.row;const r=e.node.querySelector("tr.tf-mod-select .rt-tree-container .rt-group-name").firstChild,i=r.textContent.replace(/(.*)\/$/,"$1"),a=document.createElement("input");a.value=i;try{e.node.classList.replace("jfs-mod-notRenaming","jfs-mod-renaming");const l=await function(e,t,n){const r=e.parentElement;r.replaceChild(t,e),t.focus();const s=t.value.lastIndexOf(".");return-1===s?t.setSelectionRange(0,t.value.length):t.setSelectionRange(0,s),new Promise(((s,o)=>{t.onblur=()=>{r.replaceChild(e,t),s(t.value)},t.onkeydown=e=>{switch(e.keyCode){case 13:e.stopPropagation(),e.preventDefault(),t.blur();break;case 27:e.stopPropagation(),e.preventDefault(),t.value=n,t.blur();break;case 38:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=0);break;case 40:e.stopPropagation(),e.preventDefault(),t.selectionStart!==t.selectionEnd&&(t.selectionStart=t.selectionEnd=t.value.length)}}}))}(r,a,i);if(null===(n=r.parentElement)||void 0===n||n.focus(),!l||l===t.name)return t.row;if(!(0,o.isValidFileName)(l))return(0,s.showErrorMessage)("Rename Error",Error(l+' is not a valid name. Names must have nonzero length, and cannot include "/", "\\", or ":"')),t.row;const d=t.getPathAtDepth(1).join("/"),c=d.slice(0,-1*i.length)+l,u=r.textContent.endsWith("/")?"/":"";let h;try{h=await e.treefinder.contentsProxy.rename(d+u,c+u)}catch(e){"File not renamed"!==e&&(0,s.showErrorMessage)("Rename Error",e),h=t.row}return r.textContent=l+u,h}finally{e.node.classList.replace("jfs-mod-renaming","jfs-mod-notRenaming")}},e.scrollIntoView=async function(e,t){const n=e.model;await n.flatten();const r=e.node.querySelector("tree-finder-grid");if(await r.draw(),!e.node.querySelector(".tf-mod-select .rt-tree-container .rt-group-name")){const e=n.contents.findIndex((e=>e.pathstr===t));-1!==e&&await r.scrollToCell(0,e,1,n.contents.length)}}}(J||(J={}));var K=n(6029),X=n.n(K);function Y(e){const t=e.registry.fields.ArrayField,n={...e.uiSchema};return(function(e,t){var n;for(const t of["items","template"])e=e[t]=null!==(n=e[t])&&void 0!==n?n:{};return e}(n))["ui:widget"]="textarea",K.createElement(t,{...e,uiSchema:n})}const Q=/^(?<protocol>.+?):\/\/(?:[^@]+@)?(?<resource>.*)$/,Z={};function ee(e,t,n){const r=Q.exec(t),[s,o]=C(n),i={...null==r?void 0:r.groups,url:t,path:o,full_url:`${t.replace(/\/$/,"")}/${o}`,full_path:`${s}:/${o}`,drive:s};let a=e;for(const e of Object.keys(i))e in Z||(Z[e]=new RegExp(`\\{\\{\\s*${e}\\s*\\}\\}`,"g")),a=a.replace(Z[e],i[e]);return a}const te=Object.fromEntries(["copy","cut","delete","open","paste","refresh","rename","download","create_folder","create_file","copyFullPath","copyRelativePath","restore","toggleColumnPath","toggleColumn"].map((e=>[e,`treefinder:${e}`]))),ne=["size","last_modified","writable","mimetype"];function re(e){return[e.name.split(" ").join(""),e.drive].join("_")}const se=e=>{var t;if(!e.currentWidget)return!1;const n=null===(t=e.currentWidget.treefinder.model)||void 0===t?void 0:t.selection;return!!n&&n.every((e=>e.row.writable))};function oe(e){return`${te.toggleColumn}-${e}`}function ie(e){const t=[];for(const n of e){const e=n.getPathAtDepth(1).join("/");t.push(e)}return t}async function ae(e){return`jupyterfs:snippet-${e.label}-${await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(e.label+e.caption+e.pattern.source+e.template)}`}function le(e){const t=(e.translator||l.nullTranslator).load("jupyterlab"),n=[X().createElement(a.TextItem,{source:t.__("Uploading…")})];return n.push(...e.items.map((e=>e.complete?X().createElement(a.TextItem,{source:t.__("Complete!")}):X().createElement(a.ProgressBar,{percentage:e.progress})))),X().createElement(a.GroupItem,{spacing:4},...n)}class de extends s.VDomRenderer{constructor(e){super(new de.Model(e.tracker.currentWidget)),this._onTreeFinderChange=(e,t)=>{this.model.sidebar=null===t?null:t},this.translator=e.translator||l.nullTranslator,this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onTreeFinderChange)}render(){return this.model.items.length>0?X().createElement(le,{items:this.model.items,translator:this.translator}):X().createElement(X().Fragment,null)}dispose(){super.dispose(),this._tracker.currentChanged.disconnect(this._onTreeFinderChange)}}function ce(e){return{name:"",url:"",...e}}!function(e){class t extends s.VDomModel{constructor(e){super(),this._uploadChanged=(e,t)=>{if("start"===t.name)this._items.push({path:t.newValue.path,progress:100*t.newValue.progress,complete:!1});else if("update"===t.name){const e=m.ArrayExt.findFirstIndex(this._items,(e=>e.path===t.oldValue.path));-1!==e&&(this._items[e].progress=100*t.newValue.progress)}else if("finish"===t.name){const e=m.ArrayExt.findFirstValue(this._items,(e=>e.path===t.oldValue.path));e&&(e.complete=!0,setTimeout((()=>{m.ArrayExt.removeFirstOf(this._items,e),this.stateChanged.emit(void 0)}),2e3))}else"failure"===t.name&&m.ArrayExt.removeFirstWhere(this._items,(e=>e.path===t.newValue.path));this.stateChanged.emit(void 0)},this._items=[],this._sidebar=null,this.sidebar=e}get items(){return this._items}get sidebar(){return this._sidebar}set sidebar(e){const t=this._sidebar;t&&t.treefinder.uploader.uploadChanged.disconnect(this._uploadChanged),this._sidebar=e,this._items=[],null!==this._sidebar&&this._sidebar.treefinder.uploader.uploadChanged.connect(this._uploadChanged),this.stateChanged.emit(void 0)}}e.Model=t}(de||(de={}));const ue=new f.Token("@jupyterlab/filebrowser:IFileBrowserFactory");var he=n(7704),pe=n(5034);class me{constructor(e){this.template=e,this.pattern=/(?:)/}substitute(e){return this.template.replace(this.pattern,((t,n)=>e[n]))}tokens(){const e=[];let t;for(;t=this.pattern.exec(this.template);)e.push(t[1]);return e}}class fe extends me{constructor(){super(...arguments),this.pattern=/{{(\S+?)}}/g}}function ge(e){return new fe(e).tokens()}function ve(e){var t;return"ask"===e.auth&&!e.init&&!!(null===(t=e.missingTokens)||void 0===t?void 0:t.length)}class we extends K.Component{constructor(e,t){super(e),this.state=we.initialState({open:!0,options:t})}render(){return K.createElement("div",null,K.createElement(pe.Dialog,{className:"jfs-ask-dialog",open:this.state.open,onClose:this._onClose.bind(this)},K.createElement(pe.DialogTitle,{className:"jfs-ask jfs-ask-dialog-title"},"Please enter token values for filesystem resources"),K.createElement(pe.DialogContent,{className:"jfs-ask jfs-ask-dialog-content"},this._form()),K.createElement(pe.DialogActions,{className:"jfs-ask jfs-ask-dialog-actions"},K.createElement(pe.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-cancel",onClick:this._onClose.bind(this),color:"primary"},"Cancel"),K.createElement(pe.Button,{className:"jfs-ask jfs-ask-dialog-actions-button-submit",onClick:this._onSubmit.bind(this),color:"primary"},"Submit"))))}_form(){return K.createElement("form",{className:"jfs-ask jfs-ask-form",onSubmit:this._onSubmit.bind(this),noValidate:!0,autoComplete:"off"},this._formInner())}_formInner(){return this.props.resources.map((e=>{const t=decodeURIComponent(e.url),n=ve(e)?this._inputs(e.url):[],r=ge(e.url);let s="";e.init&&this.props.options.cache?s="already initialized":r.length||(s="no template parameters");const o=`${e.name}:${s&&` ${s}`}`;return[K.createElement(pe.ExpansionPanel,{className:"jfs-ask jfs-ask-panel",disabled:!!s,expanded:!s,key:`${e.name}_panel`},K.createElement(pe.ExpansionPanelSummary,{className:"jfs-ask jfs-ask-panel-summary"},K.createElement(pe.Typography,null,o),!s&&K.createElement(pe.Tooltip,{title:t},K.createElement(pe.Typography,{noWrap:!0},t))),K.createElement(pe.ExpansionPanelDetails,{className:"jfs-ask jfs-ask-panel-details"},n))]}))}_inputs(e){return ge(e).map((t=>{var n,r,s;return K.createElement(pe.TextField,{className:"jfs-ask jfs-ask-input",autoFocus:!0,fullWidth:!0,key:`${e}_${t}`,label:t,margin:"dense",name:t,onChange:this._onChange(e).bind(this),type:(null===(n=this.state.visibility[e])||void 0===n?void 0:n[t])?"text":"password",value:(null===(r=this.state.values[e])||void 0===r?void 0:r[t])||"",InputProps:{endAdornment:K.createElement(pe.InputAdornment,{position:"end"},K.createElement(pe.IconButton,{onClick:this._onClickVisiblity(e,t).bind(this),onMouseDown:this._onMouseDownVisibility.bind(this),edge:"end"},(null===(s=this.state.visibility[e])||void 0===s?void 0:s[t])?K.createElement($.react,null):K.createElement(V.react,null)))}})}))}_onChange(e){return function(t){const n=t.target;this._setValue(e,n.name,n.value)}}_onClickVisiblity(e,t){return function(){this._toggleVisibility(e,t)}}_onMouseDownVisibility(e){e.preventDefault()}_onOpen(){this.setState({open:!0})}_onClose(){this.setState(we.initialState({options:this.state.options})),this.props.handleClose()}async _onSubmit(e){e.preventDefault(),this.props.handleSubmit(this.state.values),this._onClose()}_setValue(e,t,n){const r={...this.state.values[e],[t]:n};this.setState({values:{...this.state.values,[e]:r}})}_toggleVisibility(e,t){var n;const r={...this.state.visibility[e],[t]:!(null===(n=this.state.visibility[e])||void 0===n?void 0:n[t])};this.setState({visibility:{...this.state.visibility,[e]:r}})}}we.displayName="AskDialog",function(e){e.initialState=({open:e=!1,options:t})=>({open:e,options:{...t},values:{},visibility:{}})}(we||(we={}));class ye{constructor(){this._settings=void 0}get baseUrl(){return this.settings.baseUrl}get resourcesUrl(){return O.URLExt.join(this.baseUrl,"jupyterfs/resources")}get settings(){return this._settings||(this._settings=g.ServerConnection.makeSettings()),this._settings}}class _e extends ye{static get instance(){return void 0===_e._instance&&(_e._instance=new _e),_e._instance}async getResourcesRequest(){const e=this.settings,t=this.resourcesUrl;return g.ServerConnection.makeRequest(t,{method:"GET"},e).then((e=>200!==e.status?e.text().then((t=>{throw new g.ServerConnection.ResponseError(e,t)})):e.json()))}async initResourceRequest(e){const t=this.settings,n=this.resourcesUrl;return g.ServerConnection.makeRequest(n,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"},method:"POST"},t).then((e=>200!==e.status?e.text().then((t=>{throw new g.ServerConnection.ResponseError(e,t)})):e.json()))}}const be="jupyter-fs:plugin",xe={autoStart:!0,id:be,requires:[o.IDocumentManager,r.JupyterFrontEnd.IPaths,s.IWindowResolver,r.ILayoutRestorer,r.IRouter,i.ISettingRegistry,s.IThemeManager],optional:[d.IFormRendererRegistry],provides:ue,async activate(e,t,n,r,o,i,a,l,m){var v;const w={};let D,E;try{E=await a.load(be)}catch(e){console.warn(`Failed to load settings for the jupyter-fs extension.\n${e}`)}const k=null==E?void 0:E.composite.options;E&&c.lt((null==k?void 0:k.writtenVersion)||"0.0.0",E.version)&&(E=await async function(e){var t,n,r;const s=null==e?void 0:e.composite.options;if(c.lt((null==s?void 0:s.writtenVersion)||"0.0.0","0.4.0-alpha.8")){const s=null!==(t=null==e?void 0:e.default("snippets"))&&void 0!==t?t:[],o=s.map((e=>e.label)),i=null!==(r=(null!==(n=null==e?void 0:e.user.snippets)&&void 0!==n?n:[]).reduce(((e,t)=>(o.includes(t.label)||e.push(t),e)),[...s]))&&void 0!==r?r:[];await e.set("snippets",i)}return await e.set("options",{...s,writtenVersion:e.version}),e}(E)),m&&m.addRenderer(`${be}.snippets`,{fieldRenderer:Y});let j=null!==(v=null==E?void 0:E.composite.display_columns)&&void 0!==v?v:["size"];const P={app:e,manager:t,paths:n,resolver:r,restorer:o,router:i,columns:j,settings:E};async function S({resources:t,options:n}){var r;n.verbose&&console.info(`jupyter-fs frontend received resources:\n${JSON.stringify(t)}`),j=null!==(r=null==E?void 0:E.composite.display_columns)&&void 0!==r?r:["size"],P.columns=j;for(const e of t){const t=re(e);let n=w[t];if(!n||n.isDisposed){const r={...P,url:e.url,settings:E};n=J.sidebarFromResource(e,r),w[t]=n}else n.treefinder.columns=j}D=await async function(e,t,n,r,s){var o;const i=[],a={},l=null!==(o=null==s?void 0:s.composite.display_columns)&&void 0!==o?o:["size"],c=new h.Menu({commands:e.commands});c.title.label="Show/Hide Columns",c.title.icon=d.filterListIcon,c.addItem({command:te.toggleColumnPath});for(const t of ne)c.addItem({command:oe(t)}),a[t]=l.includes(t),i.push(e.commands.addCommand(oe(t),{execute:async e=>{a[t]=!a[t],await(null==s?void 0:s.set("display_columns",ne.filter((e=>a[e]))))},label:t,isToggleable:!0,isToggled:()=>a[t]}));const p=new h.Menu({commands:e.commands});p.title.label="Snippets";const m=await async function(e){return(await async function(e){return e||(e=g.ServerConnection.makeSettings()),g.ServerConnection.makeRequest(O.URLExt.join(e.baseUrl,"/jupyterfs/snippets"),{method:"GET"},e).then((e=>e.ok?e.json():Promise.reject(e))).then((e=>e.snippets.map((e=>({...e,pattern:new RegExp(e.pattern)})))))}()).concat(function(e){var t;return(null!==(t=null==e?void 0:e.composite.snippets)&&void 0!==t?t:[]).map((e=>({...e,pattern:new RegExp(e.pattern)})))}(e))}(s),f=[],v=new Set;for(const n of m){const r=await ae(n);v.has(r)?console.warn("Discarding duplicate snippet",n):(v.add(r),p.addItem({command:r}),f.push(e.commands.addCommand(r,{execute:async e=>{const r=t.currentWidget,s=r.treefinder.selection[0],o=ee(n.template,r.url,s.pathstr);await navigator.clipboard.writeText(o)},label:n.label,caption:n.caption,isVisible:()=>{const e=t.currentWidget,r=null==e?void 0:e.treefinder.selection;return!!(null==r?void 0:r.length)&&n.pattern.test((s=r[0],`${e.url}/${C(s.pathstr)[1]}${s.hasChildren?"/":""}`));var s}})))}const w=".jp-tree-finder-sidebar";let y=1;return[...i,...f,e.contextMenu.addItem({command:te.open,selector:w,rank:y++}),e.contextMenu.addItem({command:te.copy,selector:w,rank:y++}),e.contextMenu.addItem({command:te.cut,selector:w,rank:y++}),e.contextMenu.addItem({command:te.paste,selector:w,rank:y++}),e.contextMenu.addItem({command:te.delete,selector:w,rank:y++}),e.contextMenu.addItem({command:te.rename,selector:w,rank:y++}),e.contextMenu.addItem({command:te.download,selector:w,rank:y++}),e.contextMenu.addItem({type:"separator",selector:w,rank:y++}),e.contextMenu.addItem({command:te.copyFullPath,selector:w,rank:y++}),e.contextMenu.addItem({command:te.copyRelativePath,selector:w,rank:y++}),e.contextMenu.addItem({type:"submenu",submenu:p,selector:w,rank:y++}),e.contextMenu.addItem({type:"separator",selector:w,rank:y++}),e.contextMenu.addItem({command:te.create_file,selector:w,rank:y++}),e.contextMenu.addItem({command:te.create_folder,selector:w,rank:y++}),e.contextMenu.addItem({type:"separator",selector:w,rank:y++}),e.contextMenu.addItem({type:"submenu",submenu:c,selector:w,rank:y++}),e.contextMenu.addItem({args:{selection:!0},command:te.refresh,selector:w,rank:y++})].reduce(((e,t)=>(e.add(t),e)),new u.DisposableSet)}(e,J.tracker,J.clipboard,0,E)}async function I(){var e,t;let n=(null!==(e=null==E?void 0:E.composite.resources)&&void 0!==e?e:[]).map(ce);const r=null!==(t=null==E?void 0:E.composite.options)&&void 0!==t?t:{};function s(e=!1){D&&(D.dispose(),D=void 0);const t=n.map(re);for(const n of Object.keys(w))(e||-1===t.indexOf(n))&&(w[n].dispose(),delete w[n])}try{n=(await async function(e,t){const n=new f.PromiseDelegate;if(function(e){for(const t of e)if(ve(t))return!0;return!1}(e=await _e.instance.initResourceRequest({resources:e,options:{...t,_addServerside:!0}}))){const r=document.createElement("div");document.body.appendChild(r);let s=!1;const o=()=>{try{he.unmountComponentAtNode(r),r.remove(),s||n.resolve(e)}catch(e){n.reject(e)}},i=async r=>{try{s=!0,e=await _e.instance.initResourceRequest({resources:e.map((e=>({...e,tokenDict:r[e.url]}))),options:t}),n.resolve(e)}catch(e){n.reject(e)}};he.render(K.createElement(we,{handleClose:o,handleSubmit:i,options:t,resources:e}),r)}else n.resolve(e);return n.promise}(n,r)).filter((e=>e.init)),s(),await S({resources:n,options:r})}catch(e){console.error("Failed to refresh widgets!",e),s(!0)}}!function(e,t,n){[e.commands.addCommand(te.copy,{execute:e=>n.model.copySelection(t.currentWidget.treefinder.model),icon:d.copyIcon,label:"Copy",isVisible:()=>{var e;const n=t.currentWidget;return!!n&&!(null===(e=n.treefinder.model)||void 0===e?void 0:e.selection.some((e=>"dir"===e.row.kind)))},isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.cut,{execute:e=>n.model.cutSelection(t.currentWidget.treefinder.model),icon:d.cutIcon,label:"Cut",isEnabled:()=>se(t)}),e.commands.addCommand(te.delete,{execute:async e=>{const r=t.currentWidget.treefinder,o=r.model,i=1===o.selection.length?`Are you sure you want to permanently delete: ${o.selection[0].name}?`:`Are you sure you want to permanently delete the ${o.selection.length} selected items?`,a=await(0,s.showDialog)({title:"Delete",body:i,buttons:[s.Dialog.cancelButton({label:"Cancel"}),s.Dialog.warnButton({label:"Delete"})],defaultButton:0});!r.isDisposed&&a.button.accept&&n.model.deleteSelection(o)},icon:d.closeIcon.bindprops({stylesheet:"menuItem"}),label:"Delete",isEnabled:()=>se(t)}),e.commands.addCommand(te.open,{execute:e=>{var n;return t.currentWidget.treefinder.model.openSub.next(null===(n=t.currentWidget.treefinder.selection)||void 0===n?void 0:n.map((e=>e.row)))},label:"Open",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.paste,{execute:e=>n.model.pasteSelection(t.currentWidget.treefinder.model),icon:d.pasteIcon,label:"Paste",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.rename,{execute:e=>{const n=t.currentWidget,r=n.treefinder.selection[0];J.doRename(n,r).then((e=>{var t;null===(t=n.treefinder.model)||void 0===t||t.renamerSub.next({name:e.name,target:r}),r.row=e}))},icon:d.editIcon,label:"Rename",isEnabled:()=>se(t)}),e.commands.addCommand(te.download,{execute:async e=>{const n=t.currentWidget,r=n.treefinder.selection;await Promise.allSettled(r.map((e=>n.download(e.pathstr,e.hasChildren))))},icon:d.downloadIcon,label:"Download",isEnabled:()=>{var e,n,r;return!!(null===(r=null===(n=null===(e=t.currentWidget)||void 0===e?void 0:e.treefinder.model)||void 0===n?void 0:n.selection)||void 0===r?void 0:r.some((e=>!e.hasChildren)))}}),e.commands.addCommand(te.create_folder,{execute:async e=>{var n;const r=t.currentWidget,o=r.treefinder.model;let i=null!==(n=o.selectedLast)&&void 0!==n?n:o.root;i.hasChildren||(i=await b(i,o.root));const a=p.Path.fromarray(i.row.path);let l;try{l=await r.treefinder.contentsProxy.newUntitled({type:"directory",path:a})}catch(e){return void(0,s.showErrorMessage)("Could not create folder",e)}i.invalidate();const d=await y(o,l.path);o.refreshSub.next(x([i.row],o.root)),await J.scrollIntoView(r.treefinder,d.pathstr);const c=await J.doRename(r,d);o.renamerSub.next({name:c.name,target:d}),d.row=c},icon:d.newFolderIcon,label:"New Folder",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.create_file,{execute:async e=>{var n;const r=t.currentWidget,o=r.treefinder.model;let i=null!==(n=o.selectedLast)&&void 0!==n?n:o.root;i.hasChildren||(i=await b(i,o.root));const a=p.Path.fromarray(i.row.path);let l;try{l=await r.treefinder.contentsProxy.newUntitled({type:"file",path:a})}catch(e){return void(0,s.showErrorMessage)("Could not create file",e)}i.invalidate();const d=await y(o,l.path);o.refreshSub.next(x([i.row],o.root)),await J.scrollIntoView(r.treefinder,d.pathstr);const c=await J.doRename(r,d);o.renamerSub.next({name:c.name,target:d}),d.row=c},icon:d.fileIcon,label:"New File",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.refresh,{execute:e=>{e.selection?n.refreshSelection(t.currentWidget.treefinder.model):n.refresh(t.currentWidget.treefinder.model)},icon:d.refreshIcon,label:e=>e.selection?"Refresh Selection":"Refresh",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.copyFullPath,{execute:async e=>{const n=t.currentWidget,r=ie(n.treefinder.selection).map((e=>{var t,r;return[(r=null!==(t=n.url)&&void 0!==t?t:"",r.trimEnd().replace(/\/+$/,"")),e].join("/")}));await navigator.clipboard.writeText(r.join("\n"))},label:"Copy Full Path",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.copyRelativePath,{execute:async e=>{const n=ie(t.currentWidget.treefinder.selection);await navigator.clipboard.writeText(n.join("\n"))},label:"Copy Relative Path",isEnabled:()=>!!t.currentWidget}),e.commands.addCommand(te.toggleColumnPath,{execute:e=>{},label:"path",isEnabled:()=>!1,isToggled:()=>!0}),e.commands.addCommand(te.restore,{execute:async e=>{const n=e.rootPath.split("/"),r=t.findByDrive(e.id);if(!r)throw new Error(`Could not restore JupyterFS browser: ${e.id}`);const s=r.treefinder.model;r.preferredDir||(await _(s,n),await t.save(r))}})].reduce(((e,t)=>(e.add(t),e)),new u.DisposableSet)}(e,J.tracker,J.clipboard);const L=I();o.restore(J.tracker,{command:te.restore,args:e=>{var t;return{id:e.id,rootPath:null===(t=e.treefinder.model)||void 0===t?void 0:t.root.pathstr}},name:e=>e.id,when:L}),E&&E.changed.connect((()=>{I()}));const M=document.createElement("style");function T(e,t){return`\n      .jp-tree-finder {\n        --tf-dir-icon: url('data:image/svg+xml,${encodeURIComponent(e)}');\n        --tf-file-icon: url('data:image/svg+xml,${encodeURIComponent(t)}');\n      }\n      `}M.setAttribute("id","jupyter-fs-icon-inject");let R=!0;return l.themeChanged.connect((()=>{const t=getComputedStyle(document.documentElement).getPropertyValue("--jp-ui-font-color1");M.textContent=T(d.folderIcon.svgstr.replace(/fill="([^"]{0,7})"/,`fill="${t}"`),d.fileIcon.svgstr.replace(/fill="([^"]{0,7})"/,`fill="${t}"`)),R?(R=!1,e.restored.then((()=>{setTimeout((()=>{Object.keys(w).map((e=>w[e].treefinder.nodeInit()))}),0)}))):Object.keys(w).map((e=>w[e].treefinder.nodeInit()))})),M.textContent=T(d.folderIcon.svgstr,d.fileIcon.svgstr),document.head.appendChild(M),{tracker:J.tracker}}},Ce="jupyter-fs:progress",De={autoStart:!0,id:Ce,requires:[l.ITranslator],optional:[ue,a.IStatusBar],activate(e,t,n,r){if(!r||!n)return;const s=new de({tracker:n.tracker,translator:t});r.registerStatusItem(Ce,{item:s,align:"middle",isActive:()=>{var e;return!!(null===(e=s.model)||void 0===e?void 0:e.items.length)},activeStateChanged:s.model.stateChanged})}},Ee=[xe,De]}}]);
//# sourceMappingURL=164.34e561c7757ae646fb3c.js.map?v=34e561c7757ae646fb3c