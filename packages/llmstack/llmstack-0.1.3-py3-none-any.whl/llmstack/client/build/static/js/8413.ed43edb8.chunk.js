"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[8413],{18413:function(e,n,i){i.r(n),i.d(n,{default:function(){return _}});var t=i(93433),a=i(29439),r=i(65173),o=i(7458),s=i(85535),u=i(6334),c=i(31342),d=i(17125),l=i(83960),f=i(7276),h=i(1413),m=i(66161),p=i(13366),v=i(4550),g=i.n(v),x=i(9229),j=i(25926),y=i(45263),Z=(0,f.lazy)((function(){return Promise.all([i.e(6419),i.e(2628),i.e(2595),i.e(9921),i.e(3667),i.e(6279),i.e(1504)]).then(i.bind(i,96279))})),b=(0,f.lazy)((function(){return Promise.all([i.e(2628),i.e(2595),i.e(404)]).then(i.bind(i,41504))})),S=(0,f.lazy)((function(){return Promise.all([i.e(6419),i.e(2628),i.e(1155),i.e(4819),i.e(5396),i.e(906)]).then(i.bind(i,70906))})),w={properties:{job_name:{type:"string",title:"Job Name"},datasource:{type:"string",title:"Datasource",widget:"datasource"},frequency:{type:"string",title:"Frequency",widget:"frequencyPicker"}}},q={"ui:order":["job_name","datasource","frequency"],job_name:{"ui:description":"Enter a name for this job."},datasource:{"ui:description":"Select a datasource to setup refresh.","ui:widget":"datasource"},frequency:{"ui:description":"Select a frequency to run the application.","ui:widget":"frequencyPicker"}};function P(e){var n=(0,x.sJ)(j.NM);return(0,y.jsx)(m.Z,{sx:{width:"95%",margin:"5px"},children:(0,y.jsx)(b,{schema:w,validator:p.ZP,uiSchema:(0,h.Z)((0,h.Z)({},q),{"ui:submitButtonOptions":{norender:!0}}),formData:e.value,onChange:function(i){var t=i.formData;e.onChange((0,h.Z)((0,h.Z)({},t),{},{datasourceDetails:n.find((function(e){return e.uuid===(null===t||void 0===t?void 0:t.datasource)})),frequencyObj:null!==t&&void 0!==t&&t.frequency?JSON.parse(null===t||void 0===t?void 0:t.frequency):null}))},widgets:{datasource:function(e){return(0,y.jsx)(Z,(0,h.Z)({multiple:!1},e))},frequencyPicker:function(e){return(0,y.jsx)(S,(0,h.Z)((0,h.Z)({},e),{},{value:e.value,minStartTime:g()().add(1,"hours"),maxStartTime:g()().add(1,"years"),id:"frequency-picker"}))}}})})}var k=i(84817);function _(e){var n=(0,f.useState)({}),i=(0,a.Z)(n,2),h=i[0],m=i[1],p=(0,f.useState)([]),v=(0,a.Z)(p,2),g=v[0],x=v[1],j=(0,f.useState)([]),Z=(0,a.Z)(j,2),b=Z[0],S=Z[1];return(0,f.useEffect)((function(){null!==h&&void 0!==h&&h.datasource?(0,k.o)().get("/api/datasources/".concat(null===h||void 0===h?void 0:h.datasource,"/entries")).then((function(e){x((function(n){var i=e.data.filter((function(e){return e.sync_config&&"READY"===e.status&&e.config.document_ids.length>0}));return(0,t.Z)(i)}))})).catch((function(e){var n,i;null!==(n=e.response)&&void 0!==n&&null!==(i=n.data)&&void 0!==i&&i.message&&(0,l.yv)(e.response.data.message,{variant:"error"})})):x([])}),[h]),(0,y.jsxs)(r.ZP,{container:!0,sx:{height:"100vh"},children:[(0,y.jsx)(r.ZP,{item:!0,xs:12,sx:{height:"45%"},children:(0,y.jsxs)(o.Z,{sx:{alignItems:"start",margin:"5px"},children:[(0,y.jsx)(s.Z,{variant:"h6",sx:{marginLeft:"2px"},children:"Configuration"}),(0,y.jsx)(u.Z,{}),(0,y.jsx)(P,{onChange:function(e){m(e)},value:h})]})}),(0,y.jsx)(r.ZP,{item:!0,xs:12,sx:{height:"45%"},children:(0,y.jsxs)(o.Z,{sx:{alignItems:"start",margin:"5px"},children:[(0,y.jsx)(s.Z,{variant:"h6",sx:{marginLeft:"2px"},children:"Datasource Entries"}),(0,y.jsx)(u.Z,{}),null!==h&&void 0!==h&&h.datasource?(0,y.jsx)(d._$,{checkboxSelection:!0,columns:[{field:"name",headerName:"Name",width:500},{field:"size",headerName:"Size",width:100}],initialState:{pagination:{paginationModel:{pageSize:10}}},rows:g.map((function(e){return{id:e.uuid,name:e.name,size:e.size}})),pageSizeOptions:[10],disableRowSelectionOnClick:!0,sx:{width:"100%"},rowSelectionModel:b,onRowSelectionModelChange:function(e){S(e)}}):(0,y.jsx)("strong",{children:"Please Select a Data Source"})]})}),(0,y.jsx)(r.ZP,{item:!0,xs:12,sx:{height:"10%"},children:(0,y.jsx)(c.Z,{variant:"contained",color:"primary",disabled:!(null!==h&&void 0!==h&&h.frequencyObj)||0===b.length,onClick:function(){var e;(0,k.o)().post("/api/jobs/datasource_refresh",{job_name:null===h||void 0===h?void 0:h.job_name,app_uuid:null===h||void 0===h||null===(e=h.appDetail)||void 0===e?void 0:e.uuid,frequency:null===h||void 0===h?void 0:h.frequencyObj,datasource_entries:b}).then((function(e){(0,l.yv)("Successfully Scheduled Datasource refresh",{variant:"success"}),window.location.href="/jobs"})).catch((function(e){var n,i;null!==(n=e.response)&&void 0!==n&&null!==(i=n.data)&&void 0!==i&&i.message&&(0,l.yv)(e.response.data.message,{variant:"error"})}))},children:"Submit"})})]})}}}]);