"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[9336],{93411:function(e,t,n){n.r(t),n.d(t,{default:function(){return b},defaultChatLayout:function(){return _},defaultWorkflowLayout:function(){return Z}});var i=n(74165),r=n(15861),o=n(4942),a=n(1413),u=n(29439),s=n(83825),l=n(7276),d=n(79921),c=n(95173),p=n(30494),f=n(30982),m=n(84817),v=n(25926),g=n(9229),y=n.p+"static/media/promptly-icon.e12fae5f2a52807aaea3.png",h=n(45263),w=l.lazy((function(){return Promise.all([n.e(2715),n.e(8115),n.e(2792),n.e(6419),n.e(2385),n.e(5539),n.e(4898),n.e(3300),n.e(3361),n.e(8820),n.e(9673)]).then(n.bind(n,81792))})),x=l.lazy((function(){return Promise.all([n.e(2715),n.e(3773)]).then(n.bind(n,70081))})),Z='<pa-layout sx=\'{"maxWidth": "1200px", "margin": "10px auto"}\'>\n  <pa-paper style="padding: 10px;">\n    <pa-grid container="true" spacing="2" style="width: 100%">\n      <pa-grid item="true" xs="12">\n        <pa-input-form workflow="true"></pa-input-form>\n      </pa-grid>\n      <pa-grid item="true" xs="12">\n        <br/>\n      </pa-grid>\n      <pa-grid item="true" xs="12">\n        <pa-workflow-output showHeader="true"></pa-workflow-output>\n      </pa-grid>\n    </pa-grid>\n  </pa-paper>\n</pa-layout>',_='<pa-layout sx=\'{"maxWidth": "1200px", "margin": "0 auto", "padding": "0", "height": "100%"}\'>\n    <pa-grid container="true" spacing="2" sx=\'{"height": "100%", "flexDirection": "column"}\'>\n      <pa-grid item="true" xs="12" sx=\'{"overflow": "auto !important", "flex": "1 1 0 !important", "padding": "0 !important"}\'>\n        <pa-chat-output></pa-chat-output>\n      </pa-grid>\n      <pa-grid item="true" xs="12" sx=\'{"alignSelf": "flex-end", "flex": "0 !important", "width": "100%", "padding": "0 !important"}\'>\n        <pa-input-form clearonsubmit="true"></pa-input-form>\n      </pa-grid>\n    </pa-grid>\n</pa-layout>';function b(e){var t,n,b,A,R,S,P,k,M,q=e.app,C=e.ws,j=e.onEventDone,B=void 0===j?null:j,E=(0,l.useRef)(null),O=(0,c.TH)(),N=(0,l.useState)(""),z=(0,u.Z)(N,2),F=z[0],J=z[1],L=(0,l.useState)(!1),U=(0,u.Z)(L,2),I=U[0],W=U[1],D=(0,l.useMemo)((function(){return new s.Kj}),[]),T=D.parse((null===q||void 0===q||null===(t=q.data)||void 0===t||null===(n=t.output_template)||void 0===n?void 0:n.markdown)||""),H=(0,l.useRef)([]),K=(0,l.useRef)({}),Y=(0,l.useRef)(new f.Vm),G=(0,g.sJ)(v.nC),V=(0,g.Zl)(v.qY);C&&C.messageRef?Y.current=C.messageRef:C&&(C.messageRef=Y.current);C&&C.setOnMessage((function(e){var t,n=JSON.parse(e.data);if(n.session&&(E.current=n.session.id,V((function(e){var t;return null===e||void 0===e||null===(t=e.messages)||void 0===t||t.forEach((function(e){Y.current.add(e)})),(0,a.Z)((0,a.Z)({},e),{},{sessionId:n.session.id})}))),n.asset_request_id&&V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{assets:(0,a.Z)((0,a.Z)({},e.assets),{},(0,o.Z)({},n.asset_request_id,n.asset))})})),n.templates){var i={};Object.keys(n.templates).forEach((function(e){i[e]=D.parse(n.templates[e].markdown)})),H.current=(0,a.Z)((0,a.Z)({},H.current),i)}if(n.event&&"done"===n.event&&(V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!1,isStreaming:!1})})),B&&B(K.current),K.current={}),n.event&&"ratelimited"===n.event&&(Y.current.add(new f.us(null,n.request_id,"Rate limit exceeded. Please try after sometime.")),V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!1,isStreaming:!1,isRateLimited:!0,errors:["Rate limit exceeded"],messages:Y.current.get()})}))),n.event&&"usagelimited"===n.event&&(Y.current.add(new f.us(null,n.request_id,G?"Usage limit exceeded. Please try after adding more credits.":"Usage limit exceeded. Please login to continue.")),V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!1,isStreaming:!1,isUsageLimited:!0,errors:["Usage limit exceeded"],messages:Y.current.get()})})),G||(W(!0),d.ZP.event({category:"Account",action:"Usage Limit Login Prompt",label:null===q||void 0===q?void 0:q.name,transport:"beacon"}))),n.errors&&n.errors.length>0&&(n.errors.forEach((function(e){Y.current.add(new f.us(null,n.request_id,e))})),V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!1,isStreaming:!1,errors:n.errors,messages:Y.current.get()})})),K.current={}),n.output){var r={};r=n.output.agent?(0,p.PM)(K.current,(0,o.Z)({},n.output.agent.id,n.output.agent.content)):(0,p.PM)(K.current,n.output),K.current=r}n.id&&n.output&&function(e,t,n,i,r){return new Promise((function(o,u){if(e.output.agent){var s,l,d=e.output.agent,c=i[d.from_id];if("step_error"===d.type)return void o(new f.Ob("".concat(e.id,"/").concat(d.id),e.request_id,d.content,e.reply_to));D.render(c,"agent"===d.from_id?{agent:{content:t[d.id]}}:(null===(s=t[d.id])||void 0===s?void 0:s.output)||t[d.id]).then((function(n){l="step"===d.type?new f.hP("".concat(e.id,"/").concat(d.id),e.request_id,(0,a.Z)((0,a.Z)({},t[d.id]),{},{output:n}),e.reply_to,!d.done):new f.Rt("".concat(e.id,"/").concat(d.id),e.request_id,n,e.reply_to),o(l)})).catch((function(e){u(e)}))}else D.render(n,"playground"===r?t.processor:t).then((function(t){o(new f.sA(e.id,e.request_id,t,e.reply_to))})).catch((function(e){u(e)}))}))}(n,K.current,T,H.current,null===q||void 0===q||null===(t=q.data)||void 0===t?void 0:t.type_slug).then((function(e){Y.current.add(e),V((function(t){return(0,a.Z)((0,a.Z)({},t),{},{messages:Y.current.get(),isStreaming:null!==e.content})}))})).catch((function(e){console.error("Failed to create message object from output",e)}))}));var X=(0,l.useCallback)((function(e,t){K.current={};var n=Math.random().toString(36).substring(2);Y.current.add(new f.XZ(n,null,t)),V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!0,isStreaming:!1,errors:null,messages:Y.current.get(),input:t})})),C.send(JSON.stringify({event:"run",input:t,id:n,session_id:e})),d.ZP.event({category:"App",action:"Run App",label:null===q||void 0===q?void 0:q.name,transport:"beacon"})}),[C,q,V]),Q=(0,l.useCallback)((function(){V((function(e){return(0,a.Z)((0,a.Z)({},e),{},{isRunning:!1})})),C&&C.ws&&C.send(JSON.stringify({event:"stop"}))}),[C,V]),$=(0,l.useCallback)(function(){var e=(0,r.Z)((0,i.Z)().mark((function e(t,n,r){var o,a,u,s,l=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=!(l.length>3&&void 0!==l[3])||l[3],t){e.next=4;break}return console.error("No session ID set"),e.abrupt("return");case 4:return e.next=6,(0,m.o)().post("/api/apps/".concat(null===q||void 0===q?void 0:q.uuid,"/processors/").concat(n,"/run"),{input:r,session_id:t,preview:window.location.pathname.endsWith("/preview"),disable_history:a});case 6:if(u=e.sent,(s=null===u||void 0===u||null===(o=u.data)||void 0===o?void 0:o.output)&&"string"===typeof s)try{s=JSON.parse(s)}catch(i){console.error(i)}return e.abrupt("return",s);case 10:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),[null===q||void 0===q?void 0:q.uuid]),ee=(0,l.useCallback)((function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];C.send(JSON.stringify({event:"create_asset",data:{file_name:t,mime_type:n,streaming:i},id:e})),d.ZP.event({category:"App",action:"Create Asset",label:"".concat(null===q||void 0===q?void 0:q.name," - ").concat(n),transport:"beacon"})}),[C,q]);(0,l.useEffect)((function(){return function(){Q(),V({})}}),[O,Q,V]),(0,l.useEffect)((function(){var e,t,n,i,r;null!==q&&void 0!==q&&null!==(e=q.data)&&void 0!==e&&null!==(t=e.config)&&void 0!==t&&t.layout?J(null===q||void 0===q||null===(n=q.data)||void 0===n||null===(i=n.config)||void 0===i?void 0:i.layout):J("web"===(null===q||void 0===q||null===(r=q.data)||void 0===r?void 0:r.type_slug)?Z:_)}),[null===q||void 0===q||null===(b=q.data)||void 0===b||null===(A=b.config)||void 0===A?void 0:A.layout,null===q||void 0===q||null===(R=q.data)||void 0===R?void 0:R.type_slug]),(0,l.useEffect)((function(){var e,t;if(null!==q&&void 0!==q&&null!==(e=q.data)&&void 0!==e&&null!==(t=e.config)&&void 0!==t&&t.welcome_message){var n,i,r=new f.sA("welcome",null,null===q||void 0===q||null===(n=q.data)||void 0===n||null===(i=n.config)||void 0===i?void 0:i.welcome_message);Y.current.add(r)}return V((function(e){var t,n,i,r,o,u,s,l,d;return(0,a.Z)((0,a.Z)({},e),{},{isStreaming:!1,isRunning:!1,errors:null,inputFields:null===q||void 0===q||null===(t=q.data)||void 0===t?void 0:t.input_fields,appIntroText:null===(n=q.data)||void 0===n||null===(i=n.config)||void 0===i||null===(r=i.input_template)||void 0===r?void 0:r.replaceAll("<a href","<a target='_blank' href"),messages:Y.current.get(),processors:(null===q||void 0===q||null===(o=q.data)||void 0===o?void 0:o.processors)||[],assistantImage:(null===q||void 0===q||null===(u=q.data)||void 0===u||null===(s=u.config)||void 0===s?void 0:s.assistant_image)||y,suggestedMessages:(null===q||void 0===q||null===(l=q.data)||void 0===l||null===(d=l.config)||void 0===d?void 0:d.suggested_messages)||[]})})),function(){V({}),K.current={}}})),(0,l.useEffect)((function(){var e,t,n,i;C&&null!==q&&void 0!==q&&null!==(e=q.data)&&void 0!==e&&null!==(t=e.config)&&void 0!==t&&t.layout&&!E.current&&null!==q&&void 0!==q&&null!==(n=q.data)&&void 0!==n&&null!==(i=n.config)&&void 0!==i&&i.init_on_load&&C.send(JSON.stringify({event:"init"}))}),[C,null===q||void 0===q||null===(S=q.data)||void 0===S||null===(P=S.config)||void 0===P?void 0:P.layout,null===q||void 0===q||null===(k=q.data)||void 0===k||null===(M=k.config)||void 0===M?void 0:M.init_on_load]);var te=(0,l.memo)(w,(function(e,t){return e.runApp===t.runApp&&e.runProcessor===t.runProcessor&&e.cancelAppRun===t.cancelAppRun&&e.createAsset===t.createAsset&&e.children===t.children}));return(0,h.jsxs)(h.Fragment,{children:[I&&(0,h.jsx)(x,{open:I,handleClose:function(){return W(!1)},redirectPath:window.location.pathname}),(0,h.jsx)(te,{runApp:X,runProcessor:$,cancelAppRun:Q,createAsset:ee,children:F})]})}},30494:function(e,t,n){n.d(t,{PM:function(){return u},_C:function(){return s},zN:function(){return o}});var i=n(29439),r=n(1413);function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!+e)return"0 Bytes";var n=t<0?0:t,i=Math.floor(Math.log(e)/Math.log(1e3));return"".concat(parseFloat((e/Math.pow(1e3,i)).toFixed(n))," ").concat(["B","KB","MB","GB","TB","PB","EB","ZB","YB"][i])}function a(e,t){return e+t}function u(e,t){if(!e)return t;if(!t)return e;for(var n=(0,r.Z)({},e),o=0,s=Object.entries(t);o<s.length;o++){var l=(0,i.Z)(s[o],2),d=l[0],c=l[1];if(n[d])if(Array.isArray(c))if(Array.isArray(n[d]))for(var p=0;p<c.length;p++)if(p<n[d].length){if("string"===typeof c[p]){n[d][p]=a(n[d][p],c[p]);continue}if("number"===typeof c[p]){n[d][p]=c[p];continue}n[d][p]=u(n[d][p],c[p])}else n[d].push(c[p]);else n[d]=n[d]+c;else n[d]="object"===typeof c?u(n[d],c):"string"===typeof c?a(n[d],c):"number"===typeof c?c:n[d]+c;else n[d]=c}return n}function s(e){var t={type:"object",properties:{}},n={},i=[],r=[];return e&&e.forEach((function(e){var o,a;(i.push(e.name),e.required&&r.push(e.name),t.properties[e.name]={type:"text"===e.type||"voice"===e.type||"file"===e.type||"datasource"===e.type||"connection"===e.type||"select"===e.type?"string":e.type,title:e.title,description:e.description},e.default&&(t.properties[e.name].default=e.default),"text"===e.type&&(n[e.name]={"ui:widget":"textarea"}),"boolean"===e.type&&(n[e.name]={"ui:widget":"radio"}),"file"===e.type&&(n[e.name]={"ui:widget":"file"},t.properties[e.name].format="data-url",t.properties[e.name].pattern="data:(.*);name=(.*);base64,(.*)",t.properties[e.name].accepts=e.accept||"*",t.properties[e.name].maxSize=e.maxSize||2e6),"voice"===e.type&&(n[e.name]={"ui:widget":"voice"},e.stream||(t.properties[e.name].format="data-url",t.properties[e.name].pattern="data:(.*);name=(.*);base64,(.*)"),t.properties[e.name].stream=e.stream||!1),"select"===e.type)&&(n[e.name]={"ui:widget":"select"},t.properties[e.name].enum=null===(o=e.options)||void 0===o?void 0:o.map((function(e){return e.value})),t.properties[e.name].enumNames=null===(a=e.options)||void 0===a?void 0:a.map((function(e){return e.label})),e["ui:options"]&&n[e.name]&&(n[e.name]["ui:options"]=e["ui:options"]));"multi"===e.type&&(n[e.name]={"ui:field":"multi"},t.properties[e.name].type="object",t.properties[e.name].placeholder=e.placeholder||e.description||"",t.properties[e.name].allowFiles=e.allowFiles||!1,t.properties[e.name].filesMultiple=e.filesMultiple||!1,t.properties[e.name].filesAccept=e.filesAccept||"audio/*, video/*, image/*, text/csv, application/pdf",t.properties[e.name].filesMaxSize=e.filesMaxSize||2e6),"datasource"===e.type&&(n[e.name]={"ui:widget":"datasource"}),"connection"===e.type&&(n[e.name]={"ui:widget":"connection"})})),n["ui:order"]=i,n["ui:required"]=r,{schema:t,uiSchema:n}}}}]);