"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[686],{20686:function(n,e,t){var i=t(1413),o=t(29439),r=t(31342),c=t(54560),u=t(969),s=t(46650),l=t(10567),a=t(78735),d=t(60103),v=t(44390),f=t(31586),p=t(26235),h=t(49321),g=t(85535),Z=t(34160),y=t(13366),_=t(83960),x=t(7276),b=t(9229),m=t(25926),w=t(79921),C=t(84817),j=t(98085),E=t(41504),k=t(344),S=t(45263);e.Z=function(n){var e=n.open,t=n.onCancelCb,L=n.connection,T=(0,b.sJ)(m.w1),W=(0,x.useState)(T[0]||""),q=(0,o.Z)(W,2),O=q[0],N=q[1],R=(0,x.useState)((null===L||void 0===L?void 0:L.name)||""),D=(0,o.Z)(R,2),B=D[0],I=D[1],M=(0,x.useState)((null===L||void 0===L?void 0:L.description)||""),J=(0,o.Z)(M,2),P=J[0],z=J[1],A=(0,x.useState)((null===L||void 0===L?void 0:L.configuration)||{}),F=(0,o.Z)(A,2),V=F[0],U=F[1],G=(0,x.useState)(L||{}),H=(0,o.Z)(G,2),K=H[0],Q=H[1],X=(0,x.useState)([]),Y=(0,o.Z)(X,2),$=Y[0],nn=Y[1],en=(0,x.useState)(!1),tn=(0,o.Z)(en,2),on=tn[0],rn=tn[1],cn=(0,x.useState)(!1),un=(0,o.Z)(cn,2),sn=un[0],ln=un[1],an=(0,x.useState)(""),dn=(0,o.Z)(an,2),vn=dn[0],fn=dn[1],pn=(0,x.useState)(10),hn=(0,o.Z)(pn,2),gn=hn[0],Zn=hn[1],yn=(0,x.useState)(null),_n=(0,o.Z)(yn,2),xn=_n[0],bn=_n[1],mn=(0,b._8)((function(n){var e=n.set;return function(){(0,C.o)().get("/api/connections").then((function(n){e(m.rN,n.data)})).catch((function(n){(0,_.yv)("Error loading connections",{variant:"error"})}))}})),wn=function(n){return new Promise((function(e,t){if(!n||0===Object.keys(n).length)return(0,_.yv)("Invalid connection information provided",{variant:"error"}),void t(new Error("Invalid connection information provided"));n.id?(0,C.o)().patch("/api/connections/".concat(n.id),n).then((function(n){(0,_.yv)("Connection updated successfully",{variant:"success"}),mn(),e(n.data)})).catch((function(n){(0,_.yv)("Error updating connection",{variant:"error"}),t(n)})):((0,C.o)().post("/api/connections",n).then((function(n){(0,_.yv)("Connection created successfully",{variant:"success"}),mn(),e(n.data)})).catch((function(n){console.log(n),(0,_.yv)("Error creating connection",{variant:"error"}),t(n)})),w.ZP.event({category:"Connections",action:"Create Connection",label:n.connection_type_slug,transport:"beacon"}))}))},Cn=function(){var n=[];return B||n.push("Connection name is required"),O||n.push("Connection type is required"),0===Object.keys(V).length&&"oauth2"!==O.base_connection_type&&n.push("Configuration is required"),!(n.length>0)||(nn(n),!1)},jn=function(){I(""),z(""),U({}),t()},En=function(n){return function(){Cn()&&wn(n).then((function(n){if(Q(n),n.id){var e=new j.Ws("".concat("https:"===window.location.protocol?"wss":"ws","://").concat(window.location.host,"/ws/connections/").concat(n.id,"/activate"));e&&(bn(e),e.setOnMessage((function(n){var i=JSON.parse(n.data);"success"===i.event&&((0,_.yv)("Connection test successful",{variant:"success"}),rn(!0),e.close(),t(),mn()),"error"===i.event&&((0,_.yv)("Connection test failed".concat(i.error?": ".concat(i.error):""),{variant:"error"}),e.close()),"output"===i.event&&i.output&&i.output.ws_url&&(fn(i.output.ws_url),Zn(i.output.timeout),ln(!0))})),e.send(JSON.stringify({event:"activate"})))}}))}};return(0,x.useEffect)((function(){setTimeout((function(){return U((null===L||void 0===L?void 0:L.configuration)||{})}),500)}),[L]),(0,x.useEffect)((function(){e&&nn([])}),[e,B,P,V]),(0,x.useEffect)((function(){e&&(Q(L||{}),I((null===L||void 0===L?void 0:L.name)||""),z((null===L||void 0===L?void 0:L.description)||""),U((null===L||void 0===L?void 0:L.configuration)||{}),N(L?T.find((function(n){return n.provider_slug===(null===L||void 0===L?void 0:L.provider_slug)&&n.slug===(null===L||void 0===L?void 0:L.connection_type_slug)})):T[0]||""))}),[L,T,e]),(0,S.jsxs)(c.Z,{open:e,onClose:jn,fullWidth:!0,children:[(0,S.jsx)(u.Z,{children:"".concat(L?"Edit":"Add"," Connection")}),(0,S.jsxs)(s.Z,{children:[$.length>0&&(0,S.jsxs)(l.Z,{severity:"error",children:[(0,S.jsx)(a.Z,{children:"Errors in the form"}),(0,S.jsx)("ul",{children:$.map((function(n,e){return(0,S.jsx)("li",{children:n},e)}))})]}),(0,S.jsx)("br",{}),(0,S.jsxs)(d.Z,{fullWidth:!0,sx:{gap:"10px"},children:[(0,S.jsx)(v.Z,{label:"Name",value:B,placeholder:"Enter a name for your connection",onChange:function(n){I(n.target.value),Q((0,i.Z)((0,i.Z)({},K),{},{name:n.target.value}))},variant:"outlined"}),(0,S.jsx)(v.Z,{label:"Description",placeholder:"Enter a description for your connection",value:P,onChange:function(n){z(n.target.value),Q((0,i.Z)((0,i.Z)({},K),{},{description:n.target.value}))},multiline:!0,variant:"outlined"})]}),(0,S.jsxs)(d.Z,{fullWidth:!0,sx:{margin:"20px 0 20px 0"},children:[(0,S.jsx)(f.Z,{id:"connection-type-label",children:"Connection Type"}),(0,S.jsx)(p.Z,{label:"Connection Type",labelId:"connection-type-label",value:O?"".concat(null===O||void 0===O?void 0:O.provider_slug,":").concat(null===O||void 0===O?void 0:O.slug):"",onChange:function(n){return N(T.find((function(e){return e.provider_slug===n.target.value.split(":")[0]&&e.slug===n.target.value.split(":")[1]})))},children:T.map((function(n){return{label:n.name,value:"".concat(n.provider_slug,":").concat(n.slug)}})).map((function(n,e){return(0,S.jsx)(h.Z,{value:n.value,children:n.label},e)}))})]}),(0,S.jsx)(g.Z,{variant:"h5",children:"Configuration"}),"oauth2"===(null===O||void 0===O?void 0:O.base_connection_type)?(0,S.jsx)("div",{children:(0,S.jsx)(v.Z,{fullWidth:!0,disabled:!0,value:JSON.stringify(V),minRows:3,maxRows:3,multiline:!0})}):(0,S.jsx)(E.default,{schema:(null===O||void 0===O?void 0:O.config_schema)||{type:"object",properties:{}},validator:y.ZP,uiSchema:(0,i.Z)((0,i.Z)({},(null===O||void 0===O?void 0:O.config_ui_schema)||{}),{"ui:submitButtonOptions":{norender:!0},"ui:DescriptionFieldTemplate":function(){return null},"ui:TitleFieldTemplate":function(){return null}}),formData:V,onChange:function(n){var e=n.formData;rn(!1),U(e),Q((0,i.Z)((0,i.Z)({},K),{},{configuration:e}))},disableAdvanced:!0}),sn&&(0,S.jsx)(k.q,{wsUrl:vn,timeout:gn,onClose:function(){ln(!1),fn(null),xn.send(JSON.stringify({event:"input",input:"terminate"}))}})]}),(0,S.jsxs)(Z.Z,{children:[(0,S.jsx)(r.Z,{onClick:jn,children:"Cancel"}),function(){switch(null===O||void 0===O?void 0:O.base_connection_type){case"oauth2":return"Active"===(null===L||void 0===L?void 0:L.status)?(0,S.jsx)(r.Z,{variant:"contained",onClick:function(){Cn()&&wn((0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug,configuration:V,base_connection_type:null===O||void 0===O?void 0:O.base_connection_type})).then((function(n){Q(n),t()}))},children:"Save"}):(0,S.jsx)(r.Z,{variant:"contained",onClick:function(){Cn()&&wn((0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug,configuration:V,base_connection_type:null===O||void 0===O?void 0:O.base_connection_type})).then((function(n){var e;Q(n),window.open(null===O||void 0===O||null===(e=O.metadata)||void 0===e?void 0:e.BtnLink)}))},children:null===O||void 0===O||null===(n=O.metadata)||void 0===n?void 0:n.BtnText});var n;case"browser_login":return(0,S.jsxs)("div",{children:[!on&&(0,S.jsx)(r.Z,{onClick:En((0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug})),variant:"contained",children:"Test Connection"}),on&&(0,S.jsx)(r.Z,{onClick:function(){return n=(0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug}),void(Cn()&&wn(n).then((function(n){I(""),z(""),U({}),Q({}),t()})));var n},variant:"contained",children:"Save"})]});case"credentials":return(0,S.jsxs)("div",{children:[!on&&"promptly"!==O.provider_slug&&(0,S.jsx)(r.Z,{onClick:En((0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug,configuration:V,base_connection_type:null===O||void 0===O?void 0:O.base_connection_type})),variant:"outlined",children:"Test Connection"}),"\xa0",(0,S.jsx)(r.Z,{onClick:function(){Cn()&&wn((0,i.Z)((0,i.Z)((0,i.Z)({},L),K),{provider_slug:null===O||void 0===O?void 0:O.provider_slug,connection_type_slug:null===O||void 0===O?void 0:O.slug,configuration:V,base_connection_type:null===O||void 0===O?void 0:O.base_connection_type})).then((function(n){Q(n),n.id&&wn((0,i.Z)((0,i.Z)({},n),{status:"Active"})).then((function(){t()}))}))},variant:"contained",children:"Save"})]});default:return null}}()]})]})}},344:function(n,e,t){t.d(e,{l:function(){return Z},q:function(){return g}});var i=t(29439),o=t(54560),r=t(969),c=t(85535),u=t(46650),s=t(34160),l=t(31342),a=t(66161),d=t(82778),v=t(7276),f=t(25926),p=t(9229),h=t(45263);function g(n){var e=n.wsUrl,t=n.timeout,a=n.onClose,f=(0,v.useRef)(null),p=(0,v.useRef)(null),g=(0,v.useState)(!1),Z=(0,i.Z)(g,2),y=Z[0],_=Z[1],x=(0,v.useState)(!1),b=(0,i.Z)(x,2),m=b[0],w=b[1],C=(0,v.useState)(t),j=(0,i.Z)(C,2),E=j[0],k=j[1],S=(0,v.useCallback)((function(){if(f.current&&!p.current){var n=e.split("@")[0].split("://")[1];p.current=new d.Z(f.current,e,{credentials:{username:n.split(":")[0],password:n.split(":")[1]},scaleViewport:!0}),p.current.addEventListener("connect",(function(){console.log("Connected"),_(!0)})),p.current.addEventListener("disconnect",(function(){_(!1),w(!1),a()})),p.current.addEventListener("credentialsrequired",(function(){console.log("Credentials required")})),p.current.addEventListener("securityfailure",(function(){console.log("Security failure")})),p.current.addEventListener("capabilities",(function(){console.log("Capabilities")})),p.current.addEventListener("clipboard",(function(n){n.detail.text&&navigator.clipboard.writeText(n.detail.text)})),p.current.addEventListener("bell",(function(){console.log("Bell")})),p.current.addEventListener("desktopname",(function(){console.log("Desktop name")})),p.current.addEventListener("resize",(function(){console.log("Resize")})),p.current.addEventListener("focus",(function(){console.log("Focus")})),p.current.addEventListener("blur",(function(){console.log("Blur")}))}}),[e,a]);return(0,v.useEffect)((function(){if(e&&t&&!p.current){w(!0);var n=0,i=setInterval((function(){p.current||(S(),n++),(n>=10||p.current)&&clearInterval(i)}),1e3)}}),[e,t,S]),(0,v.useEffect)((function(){t&&a&&y&&setTimeout((function(){w(!1),a()}),1e3*t)}),[t,a,y]),(0,v.useEffect)((function(){t&&E>0&&setTimeout((function(){p.current&&k(E-1)}),1e3)}),[t,E]),(0,h.jsxs)(o.Z,{open:m,onClose:a,fullWidth:!0,PaperProps:{style:{minWidth:"1070px",overflow:"scroll"}},children:[(0,h.jsxs)(r.Z,{children:["Remote Browser - ",E,"s left",(0,h.jsx)("br",{}),(0,h.jsx)(c.Z,{variant:"caption",children:"Login to your account and press DONE when you are finished."})]}),(0,h.jsxs)(u.Z,{children:[(0,h.jsx)("div",{ref:f}),!y&&"Connecting..."]}),(0,h.jsx)(s.Z,{children:(0,h.jsx)(l.Z,{onClick:function(){return a()},variant:"contained",children:"Done"})})]})}function Z(n){var e=n.wsUrl,t=(0,v.useRef)(null),o=(0,v.useRef)(null),r=(0,v.useRef)(null),c=(0,v.useState)(!1),u=(0,i.Z)(c,2),s=u[0],l=u[1],g=(0,v.useState)(!1),Z=(0,i.Z)(g,2),y=Z[0],_=Z[1],x=(0,p.sJ)(f.lo),b=(0,v.useCallback)((function(){if(t.current&&!r.current){var n=e.split("@")[0].split("://")[1];r.current=new d.Z(t.current,e,{credentials:{username:n.split(":")[0],password:n.split(":")[1]},scaleViewport:!0}),r.current.addEventListener("connect",(function(){console.log("Connected"),l(!0)})),r.current.addEventListener("disconnect",(function(){l(!1),_(!0)})),r.current.addEventListener("credentialsrequired",(function(){console.log("Credentials required")})),r.current.addEventListener("securityfailure",(function(){console.log("Security failure")})),r.current.addEventListener("capabilities",(function(){console.log("Capabilities")})),r.current.addEventListener("clipboard",(function(n){n.detail.text&&navigator.clipboard.writeText(n.detail.text)})),r.current.addEventListener("bell",(function(){console.log("Bell")})),r.current.addEventListener("desktopname",(function(){console.log("Desktop name")})),r.current.addEventListener("resize",(function(){console.log("Resize")})),r.current.addEventListener("focus",(function(){console.log("Focus")})),r.current.addEventListener("blur",(function(){console.log("Blur")}))}}),[e]);return(0,v.useEffect)((function(){if(e&&!r.current)var n=0,i=setInterval((function(){if(r.current||(b(),n++),n>=10||r.current){if(r.current){r.current.viewOnly=!0;var e=x||t.current.clientWidth>400?t.current.clientWidth:400;t.current.style.width="".concat(e,"px"),t.current.style.height="".concat(720*e/1024,"px"),r.current.scaleViewport=!0,r.current.showDotCursor=!0}clearInterval(i)}}),1e3)}),[e,b,x]),(0,v.useEffect)((function(){y&&r.current&&(t.current.innerHTML="Video stream ended",t.current.style.height="30px")}),[y]),(0,h.jsxs)(a.Z,{ref:o,sx:{width:"100%"},children:[(0,h.jsx)("div",{ref:t}),!s&&!y&&"Loading video stream. Make sure you have stream video option set."]})}},98085:function(n,e,t){t.d(e,{Ws:function(){return r}});var i=t(15671),o=t(43144),r=function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,i.Z)(this,n),this.url=e,this.ws=null,this.binaryType=t,this.onMessage=null,this.queue=[]}return(0,o.Z)(n,[{key:"status",value:function(){return this.ws.readyState}},{key:"connect",value:function(){var n=this;this.ws=new WebSocket(this.url),this.binaryType&&(this.ws.binaryType=this.binaryType),this.ws.onmessage=this.onMessage,this.ws.onopen=function(){n.queue.forEach((function(e){n.ws.send(e)})),n.queue=[],console.log("Websocket connected: ".concat(n.url))},this.ws.onclose=function(){console.log("Websocket closed: ".concat(n.url))}}},{key:"send",value:function(n){null===this.ws&&this.connect(),this.ws.readyState===WebSocket.CONNECTING?this.queue.push(n):this.ws.readyState===WebSocket.OPEN?this.ws.send(n):(this.queue.push(n),this.connect())}},{key:"close",value:function(){var n;null===(n=this.ws)||void 0===n||n.close()}},{key:"setOnMessage",value:function(n){this.onMessage=n}}]),n}()}}]);