"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[1558,982,364],{30982:function(n,t,e){e.d(t,{Ob:function(){return v},Rt:function(){return d},Vm:function(){return f},XZ:function(){return a},hP:function(){return h},sA:function(){return l},us:function(){return c}});var s=e(60136),i=e(29388),u=e(43144),o=e(15671),r=function(){function n(t,e,s){(0,o.Z)(this,n),this.id=t||Math.random().toString(36).substring(2),this.requestId=e,this.type=null,this.content=null,this.timestamp=new Date,this.hash=null,s&&(this.content=s),this.content&&!this.hash&&(this.hash=this._buildHash())}return(0,u.Z)(n,[{key:"_buildHash",value:function(){for(var n=JSON.stringify(this.content,Object.keys(this.content).sort()),t=0,e=0;e<n.length;e++){t=(t<<5)-t+n.charCodeAt(e),t&=t}return t.toString()}},{key:"clone",value:function(){var n=this.timestamp,t=new this.constructor(this.id,this.content);return t.timestamp=n,t.requestId=this.requestId,t}}]),n}(),a=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i){var u;return(0,o.Z)(this,e),(u=t.call(this,n,s,i)).type="user",u}return(0,u.Z)(e)}(r),l=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i,u){var r;return(0,o.Z)(this,e),(r=t.call(this,n,s,i)).type="app",r.replyTo=u,r}return(0,u.Z)(e)}(r),c=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i,u){var r;return(0,o.Z)(this,e),(r=t.call(this,n,s,i)).type="error",r.replyTo=u,r}return(0,u.Z)(e)}(r),d=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i,u){var r;return(0,o.Z)(this,e),(r=t.call(this,n,s,i,u)).subType="agent",r}return(0,u.Z)(e)}(l),h=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i,u){var r,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return(0,o.Z)(this,e),(r=t.call(this,n,s,i,u)).subType="agent-step",r.isRunning=a,r}return(0,u.Z)(e)}(l),v=function(n){(0,s.Z)(e,n);var t=(0,i.Z)(e);function e(n,s,i,u){var r;return(0,o.Z)(this,e),(r=t.call(this,n,s,i,u)).subType="agent-step-error",r}return(0,u.Z)(e)}(l),f=function(){function n(){(0,o.Z)(this,n),this.messages={}}return(0,u.Z)(n,[{key:"add",value:function(n){if(n.id)if(this.messages.hasOwnProperty(n.id)){var t=this.messages[n.id].clone();t.content=n.content,t.hash=n.hash,n.hasOwnProperty("isRunning")&&(t.isRunning=n.isRunning),this.messages[n.id]=t}else this.messages[n.id]=n}},{key:"get",value:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object.values(this.messages).sort((function(t,e){return n?e.timestamp-t.timestamp:t.timestamp-e.timestamp}))}},{key:"clear",value:function(){this.messages={}}}]),n}()},38500:function(n,t,e){e.r(t);var s=e(37762),i=e(7276),u=e(31342),o=e(34199),r=e(9229),a=e(83825),l=e(30982),c=e(25926),d=e(78405),h=e(81792),v=e(93411),f=e(45263);t.default=function(n){var t,e,p,g,y,m,Z,w=n.sessionData,b=n.noHeader,k=void 0!==b&&b,_=n.skipSteps,S=void 0!==_&&_,q=null===w||void 0===w?void 0:w.store_app,T=(null===q||void 0===q||null===(t=q.data)||void 0===t?void 0:t.type_slug)||"agent",O=(0,r.Zl)(c.qY),x=(0,i.useMemo)((function(){return new a.Kj}),[]),j=(0,i.useCallback)((function(n,t){var e,s,i,u=null===q||void 0===q||null===(e=q.data)||void 0===e||null===(s=e.processors)||void 0===s||null===(i=s.find((function(n){return n.id===t})))||void 0===i?void 0:i.output_template;return u?x.renderSync(x.parse(u.markdown),n):JSON.stringify(n)}),[null===q||void 0===q||null===(e=q.data)||void 0===e?void 0:e.processors,x]);(0,i.useEffect)((function(){var n,t,e,i,u,o=[],r=(0,s.Z)((null===w||void 0===w?void 0:w.run_entry_requests)||[]);try{for(r.s();!(n=r.n()).done;){var a,c=n.value;if(o.push(new l.XZ(null,c.request_uuid,(null===(a=c.request_body)||void 0===a?void 0:a.input)||{})),"agent"===T&&!S){var d,h=(0,s.Z)(c.processor_runs);try{for(h.s();!(d=h.n()).done;){var v=d.value;o.push(new l.hP(null,null,{name:v.processor_id||"",arguments:JSON.stringify(v.input),output:j(v.output,v.processor_id)},null,!1))}}catch(f){h.e(f)}finally{h.f()}}o.push("agent"===T?new l.Rt(null,c.request_uuid,c.response_body):new l.sA(null,c.request_uuid,c.response_body))}}catch(f){r.e(f)}finally{r.f()}q&&O({messages:o,assistantImage:(null===(t=q.data)||void 0===t||null===(e=t.config)||void 0===e?void 0:e.assistant_image)||"",inputFields:(null===(i=q.data)||void 0===i?void 0:i.input_fields)||[],processors:(null===(u=q.data)||void 0===u?void 0:u.processors)||[]})}),[w,T,O,j,S,q,null===q||void 0===q||null===(p=q.data)||void 0===p||null===(g=p.config)||void 0===g?void 0:g.assistant_image,null===q||void 0===q||null===(y=q.data)||void 0===y?void 0:y.input_fields,null===q||void 0===q||null===(m=q.data)||void 0===m?void 0:m.processors]);var C=(0,i.useMemo)((function(){var n,t;return(0,f.jsx)(h.default,{noInput:!0,children:(null===q||void 0===q||null===(n=q.data)||void 0===n||null===(t=n.config)||void 0===t?void 0:t.layout)||("web"===T?v.defaultWorkflowLayout:v.defaultChatLayout)})}),[q,T]);return q?(0,f.jsxs)(o.Z,{container:!0,spacing:1,direction:"column",sx:{height:"100%"},children:[!k&&(0,f.jsx)(o.Z,{children:(0,f.jsx)(d.default,{name:q.name,icon:q.icon128,username:q.username,description:q.description,categories:q.categories,appTypeSlug:(null===q||void 0===q||null===(Z=q.data)||void 0===Z?void 0:Z.type_slug)||"agent",appStoreUuid:q.uuid,shareHeader:!0})}),(0,f.jsx)(o.Z,{sx:{flex:1,padding:4,paddingBottom:0,height:0,overflow:"auto"},children:C}),(0,f.jsx)(u.Z,{variant:"contained",component:"a",sx:{margin:2},href:"/a/".concat(q.slug),children:"Try it out now!"})]}):null}},98085:function(n,t,e){e.d(t,{Ws:function(){return u}});var s=e(15671),i=e(43144),u=function(){function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,s.Z)(this,n),this.url=t,this.ws=null,this.binaryType=e,this.onMessage=null,this.queue=[]}return(0,i.Z)(n,[{key:"status",value:function(){return this.ws.readyState}},{key:"connect",value:function(){var n=this;this.ws=new WebSocket(this.url),this.binaryType&&(this.ws.binaryType=this.binaryType),this.ws.onmessage=this.onMessage,this.ws.onopen=function(){n.queue.forEach((function(t){n.ws.send(t)})),n.queue=[],console.log("Websocket connected: ".concat(n.url))},this.ws.onclose=function(){console.log("Websocket closed: ".concat(n.url))}}},{key:"send",value:function(n){null===this.ws&&this.connect(),this.ws.readyState===WebSocket.CONNECTING?this.queue.push(n):this.ws.readyState===WebSocket.OPEN?this.ws.send(n):(this.queue.push(n),this.connect())}},{key:"close",value:function(){var n;null===(n=this.ws)||void 0===n||n.close()}},{key:"setOnMessage",value:function(n){this.onMessage=n}}]),n}()}}]);