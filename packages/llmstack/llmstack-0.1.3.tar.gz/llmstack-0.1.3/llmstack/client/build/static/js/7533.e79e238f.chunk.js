"use strict";(self.webpackChunkpromptmanager=self.webpackChunkpromptmanager||[]).push([[7533],{57533:function(e,t,n){n.r(t);var r,s,c=n(74165),i=n(15861),o=n(29439),a=n(30168),u=n(35688),l=n(74204),f=n(75062),d=n(66161),h=n(44570),p=n(85535),v=n(7276),x=n(9229),w=n(25926),g=n(76669),m=n(88290),y=n(45263),b=m.ZP.canvas(r||(r=(0,a.Z)(["\n  width: 100%;\n  height: 80px;\n  margin: 4px;\n  background-color: #edeff77d;\n  border-radius: 8px 0px 0px 8px;\n"]))),Z=m.ZP.div(s||(s=(0,a.Z)(["\n  font-size: 14px;\n  color: #183a58;\n  text-align: center;\n  margin-top: 10px;\n"]))),k=function(e){var t=e.onClearRecording;return(0,y.jsxs)(d.Z,{ml:1,mr:1,display:"flex",flexDirection:"column",alignItems:"center",children:[(0,y.jsx)(h.Z,{onClick:t,size:"small","aria-label":"Clear Recording",variant:"outlined",children:(0,y.jsx)(u.Z,{})}),(0,y.jsx)(p.Z,{style:{fontSize:"8px",textAlign:"center"},children:"Clear Recording"})]})};t.default=function(e){var t=e.createAsset,n=e.formRef,r=e.onChange,s=(0,v.useState)(!1),a=(0,o.Z)(s,2),u=a[0],p=a[1],m=(0,v.useState)(null),S=(0,o.Z)(m,2),C=S[0],R=S[1],j=(0,v.useState)(null),T=(0,o.Z)(j,2),q=T[0],A=T[1],E=(0,x.sJ)(w.qY),W=(0,v.useState)(null),I=(0,o.Z)(W,2),M=I[0],D=I[1],B=(0,v.useState)(null),P=(0,o.Z)(B,2),L=P[0],z=P[1],N=(0,v.useRef)(null),O=(0,v.useRef)(null),U=(0,v.useRef)([]),F=(0,v.useRef)(null),H=(0,v.useRef)(null),G=(0,v.useRef)(null),J=(0,v.useRef)(null),Y=(0,v.useRef)(null),K=(0,v.useState)(0),Q=(0,o.Z)(K,2),V=Q[0],X=Q[1],$=(0,v.useRef)(null),_=function(){var e=(0,i.Z)((0,c.Z)().mark((function e(){var t;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N.current&&U.current.length>0&&(t=U.current.shift(),N.current.send(new Blob(["write\n",t],{type:"text/plain"})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ee=(0,v.useCallback)((function(){if(J.current&&F.current){var e=F.current,t=e.getContext("2d"),n=J.current.frequencyBinCount,r=new Uint8Array(n);J.current.getByteTimeDomainData(r),t.fillStyle="#edeff77d",t.fillRect(0,0,e.width,e.height),t.lineWidth=2,t.strokeStyle="#183a5833",t.beginPath();for(var s=1*e.width/n,c=0,i=0;i<n;i++){var o=r[i]/128*e.height/4;0===i?t.moveTo(c,o):t.lineTo(c,o),c+=s}t.lineTo(e.width,e.height/2),t.stroke(),H.current=requestAnimationFrame(ee)}}),[]);(0,v.useEffect)((function(){if(u&&!M&&t){var e=Math.random().toString(36).substring(7);D(e),t(e,"".concat(e,".webm"),"audio/webm",!0)}if(M&&E&&null!==E&&void 0!==E&&E.assets&&null!==E&&void 0!==E&&E.assets[M]&&(z(null===E||void 0===E?void 0:E.assets[M]),N.current||(N.current=(0,g.D)(null===E||void 0===E?void 0:E.assets[M]),r(null===E||void 0===E?void 0:E.assets[M]),n.current&&setTimeout((function(){n.current.submit()}),0))),F.current){var s=F.current,c=s.getContext("2d"),i=window.devicePixelRatio||1;s.width=s.offsetWidth*i,s.height=s.offsetHeight*i,c.scale(i,i),c.font="16px Lato",c.fillStyle="#bbb",c.textAlign="center",c.textBaseline="middle",c.fillText("Please click on the microphone to start recording.",s.offsetWidth/2,s.offsetHeight/2)}}),[M,E,t,n,u,r]),(0,v.useEffect)((function(){if(L&&C)return O.current||(O.current=setInterval((0,i.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,C.requestData();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error requesting data from media recorder:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),1e3)),u||clearInterval(O.current),function(){clearInterval(O.current)}}),[L,C,u]);var te=function(){var e=(0,i.Z)((0,c.Z)().mark((function e(){var t,n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return q&&A(null),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:t=e.sent,G.current||(G.current=new(window.AudioContext||window.webkitAudioContext),J.current=G.current.createAnalyser(),J.current.fftSize=2048,ee()),Y.current=G.current.createMediaStreamSource(t),Y.current.connect(J.current),(n=new MediaRecorder(t,{mimeType:"audio/webm"})).addEventListener("dataavailable",(function(e){e.data.arrayBuffer().then((function(e){U.current.push(e),_()}))})),n.addEventListener("stop",(function(){t.getTracks().forEach((function(e){return e.stop()})),cancelAnimationFrame(H.current)})),n.start(),p(!0),R(n),$.current=setInterval((function(){X((function(e){return e+1}))}),1e3),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),console.error("Error starting recording:",e.t0);case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(){return e.apply(this,arguments)}}();return(0,y.jsxs)(d.Z,{children:[(0,y.jsxs)(d.Z,{display:"flex",alignItems:"center",sx:{boxShadow:"#ddd 1px 1px 8px",borderRadius:"8px"},children:[(0,y.jsx)(b,{ref:F}),(0,y.jsxs)(d.Z,{m:2,children:[u?(0,y.jsx)(h.Z,{onClick:function(){C&&(C.stop(),p(!1),clearInterval($.current),$.current=null,X(0),N.current&&N.current.send(new Blob(["write\n",""],{type:"text/plain"})),cancelAnimationFrame(H.current))},color:"secondary",children:(0,y.jsx)(f.Z,{})}):(0,y.jsx)(h.Z,{onClick:te,color:"primary",children:(0,y.jsx)(l.Z,{})}),(0,y.jsx)(Z,{children:"".concat(String(Math.floor(V/60)).padStart(2,"0"),":").concat(String(V%60).padStart(2,"0"))})]})]}),q&&(0,y.jsxs)(d.Z,{display:"flex",alignItems:"center",justifyContent:"center",mt:2,children:[(0,y.jsx)("audio",{src:URL.createObjectURL(q),controls:!0}),(0,y.jsx)(k,{onClearRecording:function(){A(null),e.onChange(null)}})]})]})}},76669:function(e,t,n){n.d(t,{D:function(){return s}});var r=n(98085),s=function(e){try{var t=e.replace("objref://","").split("/"),n=[t[0],t[1]],s=n[0],c=n[1],i="".concat("https:"===window.location.protocol?"wss":"ws","://").concat(window.location.host,"/ws/assets/").concat(s,"/").concat(c);return new r.Ws(i,"blob")}catch(o){console.error(o)}return null}},98085:function(e,t,n){n.d(t,{Ws:function(){return c}});var r=n(15671),s=n(43144),c=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,r.Z)(this,e),this.url=t,this.ws=null,this.binaryType=n,this.onMessage=null,this.queue=[]}return(0,s.Z)(e,[{key:"status",value:function(){return this.ws.readyState}},{key:"connect",value:function(){var e=this;this.ws=new WebSocket(this.url),this.binaryType&&(this.ws.binaryType=this.binaryType),this.ws.onmessage=this.onMessage,this.ws.onopen=function(){e.queue.forEach((function(t){e.ws.send(t)})),e.queue=[],console.log("Websocket connected: ".concat(e.url))},this.ws.onclose=function(){console.log("Websocket closed: ".concat(e.url))}}},{key:"send",value:function(e){null===this.ws&&this.connect(),this.ws.readyState===WebSocket.CONNECTING?this.queue.push(e):this.ws.readyState===WebSocket.OPEN?this.ws.send(e):(this.queue.push(e),this.connect())}},{key:"close",value:function(){var e;null===(e=this.ws)||void 0===e||e.close()}},{key:"setOnMessage",value:function(e){this.onMessage=e}}]),e}()}}]);