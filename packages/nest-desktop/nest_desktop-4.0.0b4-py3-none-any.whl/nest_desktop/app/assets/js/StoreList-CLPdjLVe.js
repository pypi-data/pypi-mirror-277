import{d as E,P as _,o as u,n as g,w as l,a as t,s as G,cf as ge,N as X,cy as re,e as $,V as c,b as x,f as h,c as w,t as I,M as ve,O as ie,b3 as Ve,m as P,q as O,l as L,cQ as de,cC as ne,z as J,cA as ue,cR as Se,p as A,r as N,F as T,c3 as Y,cS as ke,cT as C,aV as Z,cU as ye,u as je,bg as Be,c7 as we,c8 as ee,cV as De,A as xe,ca as te,cs as le,cW as Ce,v as oe,g as ae,i as M,k as Te,cX as se,c9 as _e}from"./index-BVJsRopY.js";function Fe(S){let p;try{p=new URL(S)}catch{return!1}return p.protocol==="http:"||p.protocol==="https:"}const Ue={key:0},$e={key:1},Re=E({__name:"BackendSettings",props:{store:{}},setup(S){const p=S,a=_(()=>p.store),d=e=>{e||((a.value.state.url==null||a.value.state.url.length===0)&&a.value.resetURL(),a.value.ping())};return(e,i)=>(u(),g(ve,{class:"mt-1"},{default:l(()=>[t(X,{class:"d-flex justify-center",cols:"2"},{default:l(()=>[G("div",null,[t(ge,{inset:"",title:"Enable backend",modelValue:a.value.state.enabled,"onUpdate:modelValue":i[0]||(i[0]=m=>a.value.state.enabled=m)},null,8,["modelValue"])])]),_:1}),t(X,{cols:"10"},{default:l(()=>[t(re,{disabled:!a.value.state.enabled,"hide-details":a.value.state.response.data.length===0,placeholder:a.value.defaults,rules:[m=>m.length===0||$(Fe)(m)||"URL is not valid"],"onUpdate:focused":d,class:"my-2",density:"compact",label:"URL of backend","persistent-placeholder":"",modelValue:a.value.state.url,"onUpdate:modelValue":i[2]||(i[2]=m=>a.value.state.url=m),variant:"outlined"},{append:l(()=>[t(c,{onClick:i[1]||(i[1]=m=>a.value.ping()),variant:"outlined"},{append:l(()=>[t(x,{color:a.value.isOK?"green":"red",icon:"mdi:mdi-circle"},null,8,["color"])]),default:l(()=>[h(" ping ")]),_:1})]),details:l(()=>[a.value.isOK&&a.value.isValid?(u(),w("span",Ue," Response: "+I(a.value.state.response.data),1)):(u(),w("span",$e," Error: "+I(a.value.state.error),1))]),_:1},8,["disabled","hide-details","placeholder","rules","modelValue"])]),_:1})]),_:1}))}}),Pe={class:"mx-2 font-weight-bold"},Ie=E({__name:"ExportDialog",props:{modelDBStore:{},projectDBStore:{}},setup(S){const p=S,a=_(()=>p.modelDBStore),d=_(()=>p.projectDBStore),e=ie({items:[],selected:[]}),i=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"}],m=()=>{Se(JSON.stringify(e.selected.map(b=>b.props))),e.selected=[]},F=()=>{e.selected=[],e.items=[],a.value.state.models.forEach(b=>{e.items.push({group:"model",name:b.label,props:b.toJSON()})}),d.value.state.projects.forEach(b=>{e.items.push({group:"project",name:b.name,props:b.doc?b.toJSON():b})})};return Ve(()=>{F()}),(b,k)=>(u(),g(ue,{"max-width":"1280"},{activator:l(({props:y})=>[t(c,P({icon:"mdi:mdi-export",style:{"min-width":"40px"},title:"Open dialog to export"},y),null,16)]),default:l(({isActive:y})=>[t(J,null,{default:l(()=>[t(O,{color:"transparent",density:"compact"},{default:l(()=>[G("span",Pe,[t(x,{icon:"mdi:mdi-export",size:"small"}),h(" Export ")]),t(L),t(c,{onClick:V=>y.value=!1,icon:"mdi:mdi-close",size:"small"},null,8,["onClick"])]),_:2},1024),t(de,{"group-by":[{key:"group",order:"asc"}],headers:i,items:e.items,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:e.selected,"onUpdate:modelValue":k[0]||(k[0]=V=>e.selected=V)},{"item.valid":l(({value:V})=>[t(x,{color:V?"success":"error",icon:V?"mdi-check":"mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),t(ne,null,{default:l(()=>[t(c,{disabled:e.selected.length===0,onClick:()=>{m(),y.value=!1},"prepend-icon":"mdi:mdi-export",size:"small",text:"export selected",variant:"outlined"},null,8,["disabled","onClick"]),t(c,{onClick:k[1]||(k[1]=V=>F()),"prepend-icon":"mdi:mdi-reload",size:"small",text:"Reload",variant:"outlined"}),t(c,{onClick:V=>y.value=!1,size:"small",text:"close",variant:"outlined"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1}))}}),Le={class:"mx-2 font-weight-bold"},Ne=E({__name:"ImportDialog",props:{modelDBStore:{},projectDBStore:{}},setup(S){const p=S,a=_(()=>p.modelDBStore),d=_(()=>p.projectDBStore),e=ie({githubFiles:[],githubGroup:"project",githubSelectedFile:{path:""},githubSelectedTree:{path:""},githubTag:"v3",githubTrees:[],items:[],selected:[],source:"",url:""}),i=[{icon:"network:network",title:"Import projects",value:"projects"},{icon:"nest:logo",title:"Import models",value:"models"}],m=[{icon:"mdi:mdi-paperclip",title:"Import from drive",value:"drive"},{icon:"mdi:mdi-github",title:"Import from GitHub",value:"github"},{icon:"mdi:mdi-web",title:"Import from URL",value:"url"}],F=[{title:"Name",value:"name"},{title:"Created at",key:"props.createdAt"},{title:"Version",key:"props.version"},{title:"Valid",key:"valid"}],b=r=>`https://api.github.com/repos/nest-desktop/nest-desktop-${e.githubGroup}/git/trees/`,k=r=>`https://raw.githubusercontent.com/nest-desktop/nest-desktop-${r||e.githubGroup}/${e.githubTag}/`,y=r=>{if(r==null)return;(Array.isArray(r)?r:[r]).forEach(n=>{var q,H;let s=!1;const f="elementType"in n?"model":"network"in n?"project":void 0;if(f===void 0)return;const j=[];let D,R,z="";switch(f){case"model":R=n,z=R.label||"",s=a.value.validateModel(R);break;case"project":D=n,z=D.name||"",s=d.value.validateProject(D);const U=D.network;U&&ye(U)&&((q=U.models)==null||q.forEach(v=>{v.existing&&!a.value.hasModel(v.existing)&&!j.includes(v.existing)&&j.push(v.existing)})),(H=U.nodes)==null||H.forEach(v=>{if(!("model"in v))return;const B=v;B.model&&!a.value.hasModel(B.model)&&!j.includes(B.model)&&j.push(B.model)}),C.get(k("models")+"index.json").then(v=>{v.data&&j.forEach(B=>{const Q=v.data[B];Q&&V(Q,B)})});break}e.items.push({group:f,name:z,props:n,valid:s})})},V=(r,o)=>{C.get(k("models")+r).then(n=>{if(!n.data)return;const f=(Array.isArray(n.data)?n.data:[n.data]).find(D=>D.id===o);if(!f)return;const j=a.value.validateModel(p);e.items.push({group:"model",name:f.label||"",props:f,valid:j})})},ce=r=>{e.githubSelectedFile={path:""},e.githubFiles=[],C.get(b()+r.sha).then(o=>{e.githubFiles=o.data.tree.filter(n=>n.type==="blob"&&n.path.endsWith(".json"))})},pe=()=>{e.githubSelectedTree={path:""},e.githubSelectedFile={path:""},e.githubFiles=[],e.githubTrees=[],Z(()=>{C.get(b()+`${e.githubTag}?recursive=true`).then(r=>{e.githubTrees=r.data.tree.filter(o=>o.type==="tree")})})},W=r=>{e.url.length!==0&&C.get(e.url).then(o=>y(o.data))},me=()=>{fe(),he()},fe=()=>{const r=e.selected.filter(o=>o.group==="model").map(o=>o.props);a.value.importModels(r)},he=()=>{const r=e.selected.filter(o=>o.group==="project").map(o=>o.props);d.value.importProjects(r)},K=r=>{const o=Array.isArray(r)?r[0]:r;if(!o)return;const n=new FileReader;n.readAsText(o),n.addEventListener("load",s=>{var f;return y(JSON.parse((f=s.target)==null?void 0:f.result))})},be=()=>{Z(()=>{const r=e.githubSelectedTree;!r&&!Object.keys(r).includes("path")||(e.url=k()+`${r.path}/${e.githubSelectedFile.path}`)})};return(r,o)=>(u(),g(ue,{"max-width":"1280"},{activator:l(({props:n})=>[t(c,P({icon:"mdi:mdi-import",style:{"min-width":"40px"},title:"Open dialog to import"},n),null,16)]),default:l(({isActive:n})=>[t(J,null,{default:l(()=>[t(O,{color:"transparent",density:"compact"},{default:l(()=>[G("span",Le,[t(x,{icon:"mdi:mdi-import",size:"small"}),h(" Import ")]),t(A,{class:"mx-1",density:"compact",modelValue:e.source,"onUpdate:modelValue":o[0]||(o[0]=s=>e.source=s),variant:"outlined"},{default:l(()=>[(u(),w(T,null,N(m,(s,f)=>t(c,P({key:f,style:{"min-width":"40px"},ref_for:!0},s),null,16)),64))]),_:1},8,["modelValue"]),e.source==="github"?(u(),w(T,{key:0},[t(A,{"onUpdate:modelValue":[pe,o[1]||(o[1]=s=>e.githubGroup=s)],class:"mx-1",density:"compact",modelValue:e.githubGroup,variant:"outlined"},{default:l(()=>[(u(),w(T,null,N(i,(s,f)=>t(c,P({key:f,style:{"min-width":"40px"},ref_for:!0},s),null,16)),64))]),_:1},8,["modelValue"]),t(Y,{disabled:e.githubTrees.length===0,items:e.githubTrees,label:e.githubGroup+" path","onUpdate:modelValue":[ce,o[2]||(o[2]=s=>e.githubSelectedTree=s)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path","prepend-icon":"mdi:mdi-github","return-object":"",modelValue:e.githubSelectedTree,variant:"outlined"},null,8,["disabled","items","label","modelValue"]),t(Y,{disabled:e.githubFiles.length===0,items:e.githubFiles,"onUpdate:modelValue":[be,o[3]||(o[3]=s=>e.githubSelectedFile=s)],class:"mx-1",density:"compact",flat:"","hide-details":"","item-title":"path",label:"File","return-object":"",modelValue:e.githubSelectedFile,variant:"outlined"},null,8,["disabled","items","modelValue"]),t(c,{onClick:o[4]||(o[4]=s=>W()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:l(()=>[h(" Fetch ")]),_:1})],64)):e.source==="drive"?(u(),g(ke,{key:1,"onUpdate:modelValue":K,density:"compact",flat:"","hide-details":"",label:"File","show-size":"",title:"Click to select a file","truncate-length":"100",variant:"outlined"},{append:l(()=>[t(c,{onUpload:K,flat:"","prepend-icon":"mdi:mdi-upload",variant:"outlined"},{default:l(()=>[h(" Upload ")]),_:1})]),_:1})):e.source==="url"?(u(),g(re,{key:2,class:"ma-0 pa-0",clearable:"",density:"compact",flat:"","full-width":"","hide-details":"",label:"URL","prepend-icon":"mdi:mdi-web",title:"Please enter the project's URL",modelValue:e.url,"onUpdate:modelValue":o[6]||(o[6]=s=>e.url=s),variant:"outlined"},{append:l(()=>[t(c,{onClick:o[5]||(o[5]=s=>W()),flat:"","prepend-icon":"mdi:mdi-download",variant:"outlined"},{default:l(()=>[h(" Fetch ")]),_:1})]),_:1},8,["modelValue"])):(u(),g(L,{key:3})),t(c,{onClick:s=>n.value=!1,icon:"mdi:mdi-close",size:"small"},null,8,["onClick"])]),_:2},1024),t(de,{"group-by":[{key:"group",order:"asc"}],headers:F,items:e.items,"show-expand":!1,"item-selectable":"valid","item-value":"name","return-object":"","show-select":"",modelValue:e.selected,"onUpdate:modelValue":o[7]||(o[7]=s=>e.selected=s)},{"item.valid":l(({value:s})=>[t(x,{color:s?"success":"error",icon:s?"mdi-check":"mdi-close"},null,8,["color","icon"])]),_:1},8,["items","modelValue"]),t(ne,null,{default:l(()=>[t(c,{disabled:e.selected.length===0,onClick:()=>{me(),n.value=!1},"prepend-icon":"mdi:mdi-import",size:"small",text:"import selected",variant:"outlined"},null,8,["disabled","onClick"]),t(c,{onClick:o[8]||(o[8]=s=>e.items=[]),"prepend-icon":"mdi:mdi-delete-empty-outline",size:"small",text:"Clear",variant:"outlined"}),t(c,{onClick:s=>n.value=!1,size:"small",text:"close",variant:"outlined"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1}))}}),ze=E({__name:"StoreList",props:{modelDBStore:{},modelStore:{},projectDBStore:{},projectStore:{},simulator:{}},setup(S){const p=je(),a=Be("project");return(d,e)=>(u(),g(J,{class:"mt-2"},{default:l(()=>[t(O,{color:"transparent",density:"compact"},{extension:l(()=>[t(we,{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value=i)},{default:l(()=>[t(ee,{value:"project"},{default:l(()=>[h(" Project ")]),_:1}),t(ee,{value:"model"},{default:l(()=>[h(" Model ")]),_:1}),t(L)]),_:1},8,["modelValue"])]),default:l(()=>[t(De,{size:"small"}),t(xe,null,{default:l(()=>[h("Store list")]),_:1}),t(L),t(A,{class:"mx-2",density:"compact"},{default:l(()=>[t(Ne,{modelDBStore:d.modelDBStore,projectDBStore:d.projectDBStore},null,8,["modelDBStore","projectDBStore"]),t(Ie,{modelDBStore:d.modelDBStore,projectDBStore:d.projectDBStore},null,8,["modelDBStore","projectDBStore"])]),_:1})]),_:1}),t(_e,{modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=i=>a.value=i)},{default:l(()=>[t(te,{value:"project"},{default:l(()=>[$(p).state.devMode?(u(),g(le,{key:d.projectStore.state.projectId},{default:l(()=>[h(" Current project: "+I($(Ce)(d.projectStore.state.projectId)),1)]),_:1})):oe("",!0),(u(),g(ae,{key:d.projectDBStore.state.projects.length,lines:"two",nav:""},{default:l(()=>[t(M,{to:{name:d.simulator+"ProjectNew"}},{prepend:l(()=>[t(x,{icon:"mdi:mdi-plus"})]),default:l(()=>[h(" New project ")]),_:1},8,["to"]),t(Te),t(se,null,{default:l(()=>[h("Existing projects")]),_:1}),(u(!0),w(T,null,N(d.projectDBStore.state.projects,(i,m)=>(u(),g(M,{key:m,subtitle:`${i.network.nodes.length} nodes, ${i.network.connections.length} connections`,title:i.name,to:{name:d.simulator+"Project",params:{projectId:i.id}}},null,8,["subtitle","title","to"]))),128))]),_:1}))]),_:1}),t(te,{value:"model"},{default:l(()=>[$(p).state.devMode?(u(),g(le,{key:d.modelStore.modelId},{default:l(()=>[h(" Current model: "+I(d.modelStore.modelId),1)]),_:1})):oe("",!0),(u(),g(ae,{key:d.modelDBStore.state.models.length,nav:""},{default:l(()=>[t(se,null,{default:l(()=>[h("Existing models")]),_:1}),(u(!0),w(T,null,N(d.modelDBStore.state.models,(i,m)=>(u(),g(M,{key:m,subtitle:i.elementType,title:i.label,to:{name:d.simulator+"Model",params:{modelId:i.id}}},null,8,["subtitle","title","to"]))),128))]),_:1}))]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Re as _,ze as a};
