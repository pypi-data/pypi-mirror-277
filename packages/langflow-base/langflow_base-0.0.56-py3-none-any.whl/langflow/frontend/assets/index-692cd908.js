import{aH as Y,ap as c,j as o,am as Z,an as P,aI as A,u as ee,c as O,aJ as ae,aK as ne,ar as oe,as as re,aL as se,r as S,ao as $,b as C,aM as R,I as L,aN as te,at as le,au as de}from"./index-71c35d0b.js";import{H as ce}from"./index-c9c9f065.js";import{I as ie}from"./input-8d6f9961.js";function pe(f){Y(f).then(s=>{const t=c.getState().folders.find(d=>d.id===f);s.folder_name=(t==null?void 0:t.name)||"folder",s.folder_description=(t==null?void 0:t.description)||"";const D=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(s))}`,g=document.createElement("a");g.href=D,g.download=`${s.folder_name}.json`,g.click()})}const fe=({items:f})=>o.jsx(o.Fragment,{children:f.map(s=>o.jsx(Z,{to:s.href,children:o.jsx("div",{"data-testid":`sidebar-nav-${s.title}`,className:P(A({variant:"ghost"}),"!w-[200px] cursor-pointer justify-start gap-2 border border-transparent hover:border-border hover:bg-transparent"),children:s.title},s.title)}))}),ue=fe,me=(f,s)=>{const w=c(a=>a.setFolderDragging),t=c(a=>a.setFolderIdDragging),D=ee(a=>a.setErrorData),g=c(a=>a.getFoldersApi),d=O(a=>a.flows),i=a=>{s&&s(a)},u=async a=>{if(a.dataTransfer.types.some(r=>r==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const r=a.dataTransfer.files[0];r.type==="application/json"?T(r):D({title:oe,list:[re]})}},v=(a,r)=>{a.preventDefault(),a.dataTransfer.types.some(m=>m==="Files")&&w(!0),t(r)},h=(a,r)=>{a.dataTransfer.types.some(m=>m==="Files")&&w(!0),t(r),a.preventDefault()},F=a=>{a.preventDefault(),a.target===a.currentTarget&&(w(!1),t(""))},x=(a,r)=>{var m,j;if((m=a==null?void 0:a.dataTransfer)!=null&&m.getData("flow")){const b=JSON.parse((j=a==null?void 0:a.dataTransfer)==null?void 0:j.getData("flow"));if(b){I(b.id,r);return}}a.preventDefault(),u(a)},I=(a,r)=>{const m=d.find(E=>E.id===a);if(!m)throw new Error("Flow not found");const j={...m,folder_id:r},b=ae(j,d);j.name=b,w(!1),t(""),ne(j).then(()=>{g(!0),i(r)})},T=a=>{const r=new FormData;r.append("file",a),w(!1),t(""),se(r).then(()=>{g(!0),i(f)})};return{dragOver:v,dragEnter:h,dragLeave:F,onDrop:x}},ge=({pathname:f,handleChangeFolder:s,handleEditFolder:w,handleDeleteFolder:t})=>{var _;const D=S.useRef(null),g=c(e=>e.setFolders),d=c(e=>e.folders),[i,u]=S.useState({}),v=O(e=>e.takeSnapshot),[h,F]=S.useState(d.map(e=>({name:e.name,edit:!1}))),x=c(e=>e.uploadFolder),I=f.split("/"),T=f.split("/").length<4,a=c(e=>e.myCollectionId),r=c(e=>e.getFoldersApi),m=c(e=>e.folderIdDragging),j=e=>T&&e===a?!0:I.includes(e),b=$(),E=((_=b==null?void 0:b.state)==null?void 0:_.folderId)??a,U=c(e=>e.getFolderById),V=e=>{U(e)},{dragOver:H,dragEnter:J,dragLeave:K,onDrop:M}=me(E,V),W=()=>{x(E)},z=e=>{pe(e)};function G(){de({name:"New Folder",parent_id:null,description:""}).then(e=>{r(!0)})}function q(e,B){const{target:{value:y}}=e;u(n=>({...n,[B]:y}))}return S.useEffect(()=>{d.map(e=>({name:e.name,edit:!1}))},[d]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between",children:[o.jsxs(C,{variant:"primary",onClick:G,children:[o.jsx(R,{name:"Plus",className:"main-page-nav-button"}),"New Folder"]}),o.jsxs(C,{variant:"primary",className:"px-7",onClick:W,children:[o.jsx(R,{name:"Upload",className:"main-page-nav-button"}),"Upload"]})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:d.map((e,B)=>{const y=h==null?void 0:h.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>H(n,e.id),onDragEnter:n=>J(n,e.id),onDragLeave:K,onDrop:n=>M(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:P(A({variant:"ghost"}),j(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",m===e.id?"bg-border":""),onClick:()=>s(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var N;if(e.name!=="My Projects"){if(i[e.name]||u({[e.name]:e.name}),(N=h.find(p=>p.name===e.name))!=null&&N.name){const p=h.map(l=>l.name===e.name?{name:e.name,edit:!0}:{name:l.name,edit:!1});F(p),v(),n.stopPropagation(),n.preventDefault();return}F(p=>[...p,{name:e.name,edit:!0}]),u(p=>({...p,[e.name]:e.name})),v(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-2",children:[o.jsx(L,{name:"folder",className:"mr-2 w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),y!=null&&y.edit?o.jsx("div",{children:o.jsx(ie,{className:"w-36",onChange:n=>{q(n,e.name)},ref:D,onKeyDown:n=>{var N;if(n.key==="Escape"){const p=h.map(l=>l.name===e.name?{name:e.name,edit:!1}:{name:l.name,edit:!1});F(p),u({}),F(d.map(l=>({name:l.name,edit:!1})))}n.key==="Enter"&&((N=D.current)==null||N.blur()),te(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var N,p;const n=h.map(l=>l.name===e.name?{name:e.name,edit:!1}:{name:l.name,edit:!1});if(F(n),i[e.name].trim()!==""){u(k=>({...k,[e.name]:i[e.name]}));const l={...e,name:i[e.name],flows:((N=e.flows)==null?void 0:N.length)>0?e.flows:[],components:((p=e.components)==null?void 0:p.length)>0?e.components:[]},Q=await le(l,e.id),X=d.filter(k=>k.name!==e.name);g([...X,Q]),u({}),F(d.map(k=>({name:k.name,edit:!1})))}else u(l=>({...l,[e.name]:e.name}))},value:i[e.name],id:`input-folder-${e.name}`})}):o.jsx("span",{className:"block max-w-full truncate opacity-100",children:e.name}),o.jsx("div",{className:"flex-1"}),B>0&&o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{t(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(L,{name:"trash",className:" w-4 stroke-[1.5]"})}),o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{z(e.id),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(L,{name:"Download",className:"  w-4 stroke-[1.5] text-white  "})})]})},e.id)})})})]})},he=ge;function xe({className:f,items:s,handleChangeFolder:w,handleEditFolder:t,handleDeleteFolder:D,...g}){const i=$().pathname,u=c(x=>x.loading),v=c(x=>x.folders),F=["folder","components","flows","all"].some(x=>i.includes(x));return o.jsx("nav",{className:P(f),...g,children:o.jsxs(ce,{children:[o.jsx(ue,{items:s,pathname:i}),!u&&(v==null?void 0:v.length)>0&&F&&o.jsx(he,{folders:v,pathname:i,handleChangeFolder:w,handleEditFolder:t,handleDeleteFolder:D})]})})}export{xe as S};
