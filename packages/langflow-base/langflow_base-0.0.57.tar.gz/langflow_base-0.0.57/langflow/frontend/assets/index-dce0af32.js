import{r as f,j as e,an as T,I as L,ao as O,u as b,ap as v,aq as re,ar as ce,as as ie,c as g,s as R,m as de,am as me,b as ue}from"./index-d317a0cb.js";import{u as G,a as pe,F as fe}from"./form-d9ff7145.js";import{C as he,S as q,I as xe}from"./index-59dfdadd.js";import{P as ge}from"./index-e39f177e.js";import{D as je}from"./index-58e3a29e.js";import{N as we}from"./index-fe725b43.js";import{C as Ce,S as K}from"./index-526a0aad.js";import"./textarea-a66d3242.js";import"./index-bf61e116.js";import"./index-c728caa8.js";import"./tabs-29ead35c.js";import"./index-afdd1a99.js";import"./index-6448dc1e.js";import"./input-45d38007.js";import"./select-53093098.js";import"./index-ed3300df.js";import"./index-b9b54a41.js";import"./index-ad2ba875.js";import"./index-84b64dbe.js";import"./table-8bca718a.js";function ve({onFileDrop:n,children:c,dragMessage:d}){const[i,r]=f.useState(!1);f.useEffect(()=>{const s=()=>{document.visibilityState==="visible"&&r(!1)};return document.addEventListener("visibilitychange",s),()=>{document.removeEventListener("visibilitychange",s)}},[]);const o=s=>{s.preventDefault(),s.dataTransfer.types.some(p=>p==="Files")&&n&&r(!0)},a=s=>{s.dataTransfer.types.some(p=>p==="Files")&&n&&r(!0),s.preventDefault()},l=s=>{s.preventDefault(),n&&r(!1)},u=s=>{s.preventDefault(),n&&n(s),r(!1)};return e.jsx("div",{onDragOver:o,onDragEnter:a,onDragLeave:l,onDrop:u,className:T("h-full w-full",i?"mb-36 flex flex-col items-center justify-center gap-4 text-2xl font-light":""),children:i?e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"ArrowUpToLine",className:"h-12 w-12 stroke-1"}),d||"Drop your file here"]}):c})}const Fe=(n,c)=>{var s;const d=O(),i=b(p=>p.setSuccessData),r=b(p=>p.setErrorData),o=v(p=>p.getFolderById),a=(s=d==null?void 0:d.state)==null?void 0:s.folderId,l=v(p=>p.myCollectionId);return[p=>{if(p.preventDefault(),p.dataTransfer.types.some(C=>C==="Files")){const C=p.dataTransfer.files.item(0);if(C.type==="application/json"){const F=new FileReader;F.onload=h=>{const _=h.target.result,N=JSON.parse(_).is_component;n({newProject:!0,file:C,isComponent:c==="all"?null:c==="component"}).then(()=>{i({title:`${N?"Component":"Flow"} uploaded successfully`}),o(a||l)}).catch(E=>{r({title:re,list:[E]})})},F.readAsText(C)}else r({title:ce,list:[ie]})}}]},Se=n=>{switch(n){case"all":return"Component or Flow";case"component":return"Component";default:return"Flow"}},ye=(n,c)=>{const d=c==="component",i=(o,a)=>{const l=(o==null?void 0:o.updated_at)||(o==null?void 0:o.date_created),u=(a==null?void 0:a.updated_at)||(a==null?void 0:a.date_created);return l&&u?new Date(u).getTime()-new Date(l).getTime():l?1:u?-1:0},r=c==="all"?n:n==null?void 0:n.filter(o=>((o==null?void 0:o.is_component)??!1)===d);return(r==null?void 0:r.sort(i))??[]},be=({})=>{g(d=>d.addFlow),R();const[n,c]=f.useState(!1);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-6 flex w-full items-center justify-center text-center",children:e.jsx("div",{className:"flex-max-width h-full flex-col",children:e.jsxs("div",{className:"align-center flex w-full justify-center gap-1 ",children:[e.jsx("span",{className:"text-muted-foreground",children:"This folder is empty. New?"}),e.jsxs("span",{className:"transition-colors hover:text-muted-foreground",children:[e.jsx(we,{open:n,setOpen:c}),e.jsx("button",{onClick:()=>{c(!0)},className:"underline",children:"Start Here"})]}),e.jsx("span",{className:"animate-pulse",children:"ğŸš€"})]})})})})},De=({handleSelectAll:n,handleDelete:c,handleDuplicate:d,disableFunctions:i})=>{const[r,o]=f.useState(!0),a=()=>{n(r),o(l=>!l)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-3 pb-5",children:[e.jsx("div",{className:"col-auto grid-cols-1 self-center justify-self-start",children:e.jsx("a",{onClick:a,className:"text-sm",children:e.jsx("div",{className:"header-menu-bar-display ",children:e.jsx("div",{className:"header-menu-flow-name","data-testid":"select_all_collection",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ce,{checked:!r,id:"terms"}),e.jsx("label",{onClick:a,htmlFor:"terms",className:"label cursor-pointer text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:r?"Select All":"Unselect All"})]})})})})}),e.jsxs("div",{className:"col-span-2 flex grid-cols-1 gap-2 justify-self-end",children:[e.jsx("div",{children:e.jsx(K,{content:i?e.jsx("span",{children:"Select items to duplicate"}):e.jsx("span",{children:"Duplicate selected items"}),children:e.jsx("button",{onClick:d,disabled:i,children:e.jsx(L,{name:"Copy",className:T("h-5 w-5 text-primary transition-all")})})})}),e.jsx("div",{children:e.jsx(K,{content:i?e.jsx("span",{children:"Select items to delete"}):e.jsx("span",{children:"Delete selected items"}),children:e.jsx("button",{onClick:c,disabled:i,children:e.jsx(L,{name:"Trash2",className:T("h-5 w-5 text-primary transition-all",i?"":"hover:text-destructive")})})})})]})]})})};function Ne({type:n="all"}){var $;const c=g(t=>t.uploadFlow),d=g(t=>t.removeFlow),i=g(t=>t.isLoading),r=g(t=>t.setAllFlows),o=g(t=>t.allFlows),a=v(t=>{var m;return(m=t.selectedFolder)==null?void 0:m.flows}),l=b(t=>t.setSuccessData),u=b(t=>t.setErrorData),[s,p]=f.useState(!1),C=g(t=>t.searchFlowsComponents),F=g(t=>t.setSelectedFlowsComponentsCards),h=g(t=>t.selectedFlowsComponentsCards),[_]=Fe(c,n),[D,N]=f.useState(20),[E,P]=f.useState(1),Q=R(),I=O(),k=ye(o,n),M=(E-1)*D,X=M+D,j=k==null?void 0:k.slice(M,X),Y=Se(n),w=($=I==null?void 0:I.state)==null?void 0:$.folderId,A=v(t=>t.getFolderById),S=v(t=>t.myCollectionId),B=v(t=>t.getFoldersApi),Z=v(t=>t.setFolderUrl),ee=g(t=>t.addFlow);f.useEffect(()=>{Z(w??""),F([]),J(!1),A(w||S)},[I]),f.useEffect(()=>{const t=de.cloneDeep(a),m=t==null?void 0:t.filter(x=>x.name.toLowerCase().includes(C.toLowerCase())||x.description.toLowerCase().includes(C.toLowerCase()));C===""&&r(a),r(m)},[C]);const U=()=>{P(1),N(20)},{getValues:V,control:z,setValue:H}=G(),y=pe({control:z}),te=G(),J=t=>{const m=a==null?void 0:a.map(x=>x.id);if(t){Object.keys(V()).forEach(x=>{m!=null&&m.includes(x)&&H(x,!0)});return}Object.keys(V()).forEach(x=>{H(x,!1)})},W=t=>{if(!((h==null?void 0:h.length)>0)){u({title:"No items selected",list:["Please select items to delete"]});return}t==="delete"?p(!0):t==="duplicate"&&se()},se=()=>{Promise.all(h.map(t=>ee(!0,o.find(m=>m.id===t)))).then(()=>{U(),B(!0),(!w||w===S)&&A(w||S),F([]),l({title:"Flows duplicated successfully"})})},ne=()=>{d(h).then(()=>{U(),B(!0),(!w||w===S)&&A(w||S),l({title:"Selected items deleted successfully!"})}).catch(()=>{u({title:"Error deleting items",list:["Please try again"]})})};f.useEffect(()=>{if(!y||Object.keys(y).length===0)return;const t=Object.keys(y).filter(m=>y[m]===!0);F(t)},[y]);const oe=f.useMemo(()=>{const t=x=>({all:"item",component:"component",flow:"flow"})[x]||"",m=x=>({all:"items",component:"components",flow:"flows"})[x]||"";return(h==null?void 0:h.length)===1?t(n):m(n)},[h,n]),le=()=>{var t;return n==="all"?o==null?void 0:o.length:(t=o==null?void 0:o.filter(m=>(m.is_component??!1)===(n==="component")))==null?void 0:t.length};return e.jsxs(e.Fragment,{children:[(o==null?void 0:o.length)>0&&e.jsx(De,{handleDelete:()=>W("delete"),handleSelectAll:J,handleDuplicate:()=>W("duplicate"),disableFunctions:!((h==null?void 0:h.length)>0)}),e.jsx(ve,{onFileDrop:_,dragMessage:`Drag your ${Y} here`,children:e.jsxs("div",{className:"flex h-full w-full flex-col justify-between",children:[e.jsx("div",{className:"flex w-full flex-col gap-4",children:!i&&(j==null?void 0:j.length)===0?e.jsx(be,{}):e.jsx("div",{className:"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-2",children:i===!1&&(j==null?void 0:j.length)>0?e.jsx(e.Fragment,{children:j==null?void 0:j.map(t=>f.createElement(fe,{...te,key:t.id},e.jsx("form",{children:e.jsx(he,{is_component:n==="component",data:{is_component:t.is_component??!1,...t},disabled:i,"data-testid":"edit-flow-button-"+t.id,button:t.is_component?e.jsx(e.Fragment,{}):e.jsx(me,{to:"/flow/"+t.id,children:e.jsxs(ue,{tabIndex:-1,variant:"outline",size:"sm",className:"whitespace-nowrap","data-testid":"edit-flow-button-"+t.id,children:[e.jsx(L,{name:"ExternalLink",className:"main-page-nav-button select-none"}),"Edit Flow"]})}),onClick:t.is_component?void 0:()=>{Q("/flow/"+t.id)},playground:!t.is_component,control:z})})))}):e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(q,{})]})})}),!i&&(j==null?void 0:j.length)>0&&e.jsx("div",{className:"relative py-6",children:e.jsx(ge,{storeComponent:!0,pageIndex:E,pageSize:D,rowsCount:[10,20,50,100],totalRowsCount:le(),paginate:(t,m)=>{P(m),N(t)}})})]})}),s&&e.jsx(je,{open:s,setOpen:p,onConfirm:ne,description:oe,children:e.jsx(e.Fragment,{})})]})}const Ee=({tabsOptions:n,setActiveTab:c,loading:d,tabActive:i})=>{const r=R(),o=v(l=>l.folderUrl),a=l=>{const u=window.location.pathname;let s="";switch(l){case"Flows":s=u.replace(/components|all/,"flows");break;case"Components":s=u.replace(/flows|all/,"components");break;default:s=u.replace(/flows|components/,"all");break}r(s,{state:{folderId:o}})};return f.useEffect(()=>{const l=window.location.pathname;l.includes("components")?c("Components"):l.includes("flows")?c("Flows"):c("All")},[window.location.pathname]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"ml-4 flex w-full gap-2 border-b border-border",children:n.map((l,u)=>e.jsx("button",{"data-testid":`${l}-button-store`,disabled:d,onClick:()=>{a(l)},className:(i===l?"border-b-2 border-primary p-3":" border-b-2 border-transparent p-3 text-muted-foreground hover:text-primary")+(d?" cursor-not-allowed ":""),children:l},u))})})},Ie=({})=>{var u;const n=O(),c=v(s=>s.myCollectionId);(u=n==null?void 0:n.state)!=null&&u.folderId;const d=g(s=>s.isLoading),[i,r]=f.useState("Flows");b(s=>s.setErrorData),g(s=>s.allFlows);const[o,a]=f.useState(""),l=g(s=>s.setSearchFlowsComponents);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex items-end gap-4",children:[e.jsx(xe,{loading:d,value:o,onChange:s=>{l(s.target.value),a(s.target.value)},onKeyDown:s=>{s.key==="Enter"&&l(o)}}),e.jsx(Ee,{tabsOptions:["All","Flows","Components"],setActiveTab:r,loading:d,tabActive:i})]})})},Qe=({key:n,type:c})=>e.jsxs(e.Fragment,{children:[e.jsx(Ie,{}),e.jsx("div",{className:"mt-5 flex h-full flex-col",children:e.jsx(Ne,{type:c},n)})]});export{Qe as default};
