import{aH as Y,ap as i,j as o,am as Z,an as P,aI as A,u as ee,c as O,aJ as ae,aK as ne,ar as oe,as as re,aL as se,r as S,ao as $,b as C,aM as R,I as L,aN as te,at as le,au as de}from"./index-d317a0cb.js";import{H as ce}from"./index-3418b5d5.js";import{I as ie}from"./input-45d38007.js";function fe(u){Y(u).then(l=>{const t=i.getState().folders.find(c=>c.id===u);l.folder_name=(t==null?void 0:t.name)||"folder",l.folder_description=(t==null?void 0:t.description)||"";const b=`data:text/json;chatset=utf-8,${encodeURIComponent(JSON.stringify(l))}`,h=document.createElement("a");h.href=b,h.download=`${l.folder_name}.json`,h.click()})}const pe=({items:u,pathname:l})=>o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:u.map(s=>o.jsx(Z,{to:s.href,children:o.jsxs("div",{"data-testid":`sidebar-nav-${s.title}`,className:P(A({variant:"ghost"}),l===s.href?"border border-border bg-muted hover:bg-muted":"border border-transparent hover:border-border hover:bg-transparent","flex w-full shrink-0 justify-start gap-4"),children:[s.icon,o.jsx("span",{className:"block max-w-full truncate opacity-100",children:s.title})]},s.title)}))}),ue=pe,me=(u,l)=>{const s=i(a=>a.setFolderDragging),t=i(a=>a.setFolderIdDragging),b=ee(a=>a.setErrorData),h=i(a=>a.getFoldersApi),c=O(a=>a.flows),f=a=>{l&&l(a)},m=async a=>{if(a.dataTransfer.types.some(r=>r==="Files")&&a.dataTransfer.files&&a.dataTransfer.files.length>0){const r=a.dataTransfer.files[0];r.type==="application/json"?T(r):b({title:oe,list:[re]})}},v=(a,r)=>{a.preventDefault(),a.dataTransfer.types.some(g=>g==="Files")&&s(!0),t(r)},F=(a,r)=>{a.dataTransfer.types.some(g=>g==="Files")&&s(!0),t(r),a.preventDefault()},w=a=>{a.preventDefault(),a.target===a.currentTarget&&(s(!1),t(""))},x=(a,r)=>{var g,D;if((g=a==null?void 0:a.dataTransfer)!=null&&g.getData("flow")){const j=JSON.parse((D=a==null?void 0:a.dataTransfer)==null?void 0:D.getData("flow"));if(j){I(j.id,r);return}}a.preventDefault(),m(a)},I=(a,r)=>{const g=c.find(E=>E.id===a);if(!g)throw new Error("Flow not found");const D={...g,folder_id:r},j=ae(D,c);D.name=j,s(!1),t(""),ne(D).then(()=>{h(!0),f(r)})},T=a=>{const r=new FormData;r.append("file",a),s(!1),t(""),se(r).then(()=>{h(!0),f(u)})};return{dragOver:v,dragEnter:F,dragLeave:w,onDrop:x}},ge=({pathname:u,handleChangeFolder:l,handleEditFolder:s,handleDeleteFolder:t})=>{var _;const b=S.useRef(null),h=i(e=>e.setFolders),c=i(e=>e.folders),[f,m]=S.useState({}),v=O(e=>e.takeSnapshot),[F,w]=S.useState(c.map(e=>({name:e.name,edit:!1}))),x=i(e=>e.uploadFolder),I=u.split("/"),T=u.split("/").length<4,a=i(e=>e.myCollectionId),r=i(e=>e.getFoldersApi),g=i(e=>e.folderIdDragging),D=e=>T&&e===a?!0:I.includes(e),j=$(),E=((_=j==null?void 0:j.state)==null?void 0:_.folderId)??a,z=i(e=>e.getFolderById),U=e=>{z(e)},{dragOver:V,dragEnter:H,dragLeave:J,onDrop:K}=me(E,U),M=()=>{x(E)},W=e=>{fe(e)};function G(){de({name:"New Folder",parent_id:null,description:""}).then(e=>{r(!0)})}function q(e,B){const{target:{value:k}}=e;m(n=>({...n,[B]:k}))}return S.useEffect(()=>{c.map(e=>({name:e.name,edit:!1}))},[c]),o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex shrink-0 items-center justify-between gap-2",children:[o.jsx("div",{className:"flex-1 self-start text-lg font-semibold",children:"Folders"}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:G,"data-testid":"add-folder-button",children:o.jsx(R,{name:"FolderPlus",className:"w-4"})}),o.jsx(C,{variant:"primary",size:"icon",className:"px-2",onClick:M,"data-testid":"upload-folder-button",children:o.jsx(R,{name:"Upload",className:"w-4"})})]}),o.jsx("div",{className:"flex gap-2 overflow-auto lg:h-[70vh] lg:flex-col",children:o.jsx(o.Fragment,{children:c.map((e,B)=>{const k=F==null?void 0:F.filter(n=>n.name===e.name)[0];return o.jsx("div",{onDragOver:n=>V(n,e.id),onDragEnter:n=>H(n,e.id),onDragLeave:J,onDrop:n=>K(n,e.id),"data-testid":`sidebar-nav-${e.name}`,className:P(A({variant:"ghost"}),D(e.id)?"border border-border bg-muted hover:bg-muted":"border hover:bg-transparent lg:border-transparent lg:hover:border-border","group flex w-full shrink-0 cursor-pointer gap-2 opacity-100 lg:min-w-full",g===e.id?"bg-border":""),onClick:()=>l(e.id),children:o.jsxs("div",{onDoubleClick:n=>{var N;if(e.name!=="My Projects"){if(f[e.name]||m({[e.name]:e.name}),(N=F.find(p=>p.name===e.name))!=null&&N.name){const p=F.map(d=>d.name===e.name?{name:e.name,edit:!0}:{name:d.name,edit:!1});w(p),v(),n.stopPropagation(),n.preventDefault();return}w(p=>[...p,{name:e.name,edit:!0}]),m(p=>({...p,[e.name]:e.name})),v(),n.stopPropagation(),n.preventDefault()}},className:"flex w-full items-center gap-4",children:[o.jsx(L,{name:"folder",className:"w-4 flex-shrink-0 justify-start stroke-[1.5] opacity-100"}),k!=null&&k.edit?o.jsx("div",{children:o.jsx(ie,{className:"w-36",onChange:n=>{q(n,e.name)},ref:b,onKeyDown:n=>{var N;if(n.key==="Escape"){const p=F.map(d=>d.name===e.name?{name:e.name,edit:!1}:{name:d.name,edit:!1});w(p),m({}),w(c.map(d=>({name:d.name,edit:!1})))}n.key==="Enter"&&((N=b.current)==null||N.blur()),te(n,n.key,"")},autoFocus:!0,onBlur:async()=>{var N,p;const n=F.map(d=>d.name===e.name?{name:e.name,edit:!1}:{name:d.name,edit:!1});if(w(n),f[e.name].trim()!==""){m(y=>({...y,[e.name]:f[e.name]}));const d={...e,name:f[e.name],flows:((N=e.flows)==null?void 0:N.length)>0?e.flows:[],components:((p=e.components)==null?void 0:p.length)>0?e.components:[]},Q=await le(d,e.id),X=c.filter(y=>y.name!==e.name);h([...X,Q]),m({}),w(c.map(y=>({name:y.name,edit:!1})))}else m(d=>({...d,[e.name]:e.name}))},value:f[e.name],id:`input-folder-${e.name}`,"data-testid":"input-folder"})}):o.jsx("span",{className:"block w-full truncate opacity-100",children:e.name}),B>0&&o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{t(e),n.stopPropagation(),n.preventDefault()},variant:"ghost",children:o.jsx(L,{name:"trash",className:" w-4 stroke-[1.5]"})}),o.jsx(C,{className:"hidden p-0 hover:bg-white group-hover:block hover:dark:bg-[#0c101a00]",onClick:n=>{W(e.id),n.stopPropagation(),n.preventDefault()},size:"none",variant:"none",children:o.jsx(L,{name:"Download",className:"  w-4 stroke-[1.5] text-white  "})})]})},e.id)})})})]})},he=ge;function xe({className:u,items:l,handleChangeFolder:s,handleEditFolder:t,handleDeleteFolder:b,...h}){const f=$().pathname,m=i(x=>x.loading),v=i(x=>x.folders),w=["folder","components","flows","all"].some(x=>f.includes(x));return o.jsx("nav",{className:P(u),...h,children:o.jsx(ce,{children:l.length>0?o.jsx(ue,{items:l,pathname:f}):!m&&(v==null?void 0:v.length)>0&&w&&o.jsx(he,{folders:v,pathname:f,handleChangeFolder:s,handleEditFolder:t,handleDeleteFolder:b})})})}export{xe as S};
