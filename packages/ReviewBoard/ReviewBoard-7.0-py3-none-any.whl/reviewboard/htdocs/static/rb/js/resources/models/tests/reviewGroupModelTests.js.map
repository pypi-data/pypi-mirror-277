{"version":3,"file":"reviewGroupModelTests.js","names":["suite","describe","url","group","session","beforeEach","RB","UserSession","instance","create","username","watchedReviewGroupsURL","ReviewGroup","id","spyOn","watchedGroups","and","callThrough","it","$","callFake","request","expect","type","toBe","success","stat","setStarred","addImmediately","toHaveBeenCalled","apiCall","ajax","removeImmediately","done","console","warn","error","fail","name","data","addUser","set","isNew","expectAsync","toBeRejectedWith","Error","not","removeUser"],"sources":["../../../../../../../static/rb/js/resources/models/tests/reviewGroupModelTests.es6.js"],"sourcesContent":["suite('rb/resources/models/ReviewGroup', function() {\n    describe('setStarred', function() {\n        const url = '/api/users/testuser/watched/groups/';\n        let group;\n        let session;\n\n        beforeEach(function() {\n            RB.UserSession.instance = null;\n            session = RB.UserSession.create({\n                username: 'testuser',\n                watchedReviewGroupsURL: url,\n            });\n\n            group = new RB.ReviewGroup({\n                id: 1,\n            });\n\n            spyOn(session.watchedGroups, 'addImmediately').and.callThrough();\n            spyOn(session.watchedGroups, 'removeImmediately').and.callThrough();\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('true', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.setStarred(true);\n\n            expect(session.watchedGroups.addImmediately)\n                .toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('false', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n                expect(request.url).toBe(url + '1/');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.setStarred(false);\n\n            expect(session.watchedGroups.removeImmediately)\n                .toHaveBeenCalled();\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.url).toBe(url);\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n            spyOn(console, 'warn');\n\n            group.setStarred(true, {\n                success: () => {\n                    expect(session.watchedGroups.addImmediately)\n                        .toHaveBeenCalled();\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n    });\n\n    describe('addUser', function() {\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('Loaded group', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n\n            await group.addUser('my-user');\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('POST');\n                expect(request.data.username).toBe('my-user');\n\n                request.success({\n                    stat: 'ok',\n                });\n            });\n            spyOn(console, 'warn');\n\n            group.addUser('my-user', {\n                success: () => {\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n\n        it('Unloaded group', async function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            await expectAsync(group.addUser('my-user')).toBeRejectedWith(\n                Error('Unable to add to the group.'));\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n        });\n    });\n\n    describe('removeUser', function() {\n        let group;\n\n        beforeEach(function() {\n            group = new RB.ReviewGroup({\n                id: 1,\n                name: 'test-group',\n            });\n\n            spyOn(RB, 'apiCall').and.callThrough();\n        });\n\n        it('Loaded group', async function() {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n\n            await group.removeUser('my-user');\n            expect(RB.apiCall).toHaveBeenCalled();\n            expect($.ajax).toHaveBeenCalled();\n        });\n\n        it('With callbacks', function(done) {\n            spyOn($, 'ajax').and.callFake(request => {\n                expect(request.type).toBe('DELETE');\n\n                request.success();\n            });\n            spyOn(console, 'warn');\n\n            group.removeUser('my-user', {\n                success: () => {\n                    expect(RB.apiCall).toHaveBeenCalled();\n                    expect($.ajax).toHaveBeenCalled();\n                    expect(console.warn).toHaveBeenCalled();\n\n                    done();\n                },\n                error: () => done.fail(),\n            });\n        });\n\n        it('Unloaded group', async function() {\n            spyOn($, 'ajax');\n\n            group.set('id', null);\n            expect(group.isNew()).toBe(true);\n\n            await expectAsync(group.removeUser('my-user')).toBeRejectedWith(\n                Error('Unable to remove from the group.'));\n\n            expect(RB.apiCall).not.toHaveBeenCalled();\n            expect($.ajax).not.toHaveBeenCalled();\n        });\n    });\n});\n"],"mappings":"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","ignoreList":[]}